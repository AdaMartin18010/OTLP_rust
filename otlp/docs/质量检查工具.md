# OTLP文档质量检查工具

## 📋 概述

本文档提供了OTLP Rust项目文档质量检查的工具和方法，确保文档的准确性、完整性和一致性。

**创建时间**: 2025年1月27日  
**工具版本**: v1.0  
**适用范围**: 所有项目文档  

## 🛠️ 检查工具

### 1. 链接检查工具

#### 1.1 markdown-link-check

```bash
# 安装
npm install -g markdown-link-check

# 检查单个文件
markdown-link-check README.md

# 检查所有markdown文件
find . -name "*.md" -exec markdown-link-check {} \;

# 检查并忽略外部链接
markdown-link-check README.md --ignore "https://"
```

#### 1.2 自定义链接检查脚本

```bash
#!/bin/bash
# link_checker.sh

echo "开始检查文档链接..."

# 检查内部链接
echo "检查内部链接..."
find . -name "*.md" -exec grep -l "\[.*\](.*\.md)" {} \; | while read file; do
    echo "检查文件: $file"
    grep -o "\[.*\](.*\.md)" "$file" | while read link; do
        target=$(echo "$link" | sed 's/.*(\(.*\))/\1/')
        if [ ! -f "$target" ]; then
            echo "错误: $file 中的链接 $link 指向不存在的文件 $target"
        fi
    done
done

# 检查外部链接
echo "检查外部链接..."
find . -name "*.md" -exec grep -l "https://" {} \; | while read file; do
    echo "检查文件: $file"
    grep -o "https://[^)]*" "$file" | while read url; do
        if ! curl -s --head "$url" | head -n 1 | grep -q "200 OK"; then
            echo "警告: $file 中的链接 $url 可能无法访问"
        fi
    done
done

echo "链接检查完成"
```

### 2. 格式检查工具

#### 2.1 markdownlint

```bash
# 安装
npm install -g markdownlint-cli

# 检查单个文件
markdownlint README.md

# 检查所有markdown文件
markdownlint "**/*.md"

# 使用配置文件
markdownlint -c .markdownlint.json "**/*.md"
```

#### 2.2 自定义格式检查脚本

```bash
#!/bin/bash
# format_checker.sh

echo "开始检查文档格式..."

# 检查标题层级
echo "检查标题层级..."
find . -name "*.md" -exec grep -n "^#" {} \; | while read line; do
    file=$(echo "$line" | cut -d: -f1)
    line_num=$(echo "$line" | cut -d: -f2)
    content=$(echo "$line" | cut -d: -f3-)
    
    # 检查标题格式
    if [[ ! "$content" =~ ^#+\ + ]]; then
        echo "错误: $file:$line_num 标题格式不正确: $content"
    fi
done

# 检查代码块格式
echo "检查代码块格式..."
find . -name "*.md" -exec grep -n "```" {} \; | while read line; do
    file=$(echo "$line" | cut -d: -f1)
    line_num=$(echo "$line" | cut -d: -f2)
    content=$(echo "$line" | cut -d: -f3-)
    
    # 检查代码块语言标识
    if [[ "$content" =~ ^```[a-zA-Z]*$ ]]; then
        lang=$(echo "$content" | sed 's/```//')
        if [[ ! "$lang" =~ ^(rust|bash|text|json|yaml|toml)$ ]]; then
            echo "警告: $file:$line_num 未知的代码块语言: $lang"
        fi
    fi
done

# 检查表格格式
echo "检查表格格式..."
find . -name "*.md" -exec grep -n "|" {} \; | while read line; do
    file=$(echo "$line" | cut -d: -f1)
    line_num=$(echo "$line" | cut -d: -f2)
    content=$(echo "$line" | cut -d: -f3-)
    
    # 检查表格分隔符
    if [[ "$content" =~ ^\|.*\|$ ]]; then
        if [[ ! "$content" =~ ^\|.*\|.*\|$ ]]; then
            echo "警告: $file:$line_num 表格格式可能不正确: $content"
        fi
    fi
done

echo "格式检查完成"
```

### 3. 内容检查工具

#### 3.1 拼写检查

```bash
# 安装cspell
npm install -g cspell

# 检查单个文件
cspell README.md

# 检查所有文件
cspell "**/*.md"

# 使用配置文件
cspell --config cspell.json "**/*.md"
```

#### 3.2 自定义内容检查脚本

```bash
#!/bin/bash
# content_checker.sh

echo "开始检查文档内容..."

# 检查文档结构
echo "检查文档结构..."
find . -name "*.md" -exec grep -l "^# " {} \; | while read file; do
    # 检查是否有目录
    if ! grep -q "^## " "$file"; then
        echo "警告: $file 缺少二级标题"
    fi
    
    # 检查是否有概述部分
    if ! grep -q "## 📋 概述\|## 概述" "$file"; then
        echo "警告: $file 缺少概述部分"
    fi
done

# 检查代码示例
echo "检查代码示例..."
find . -name "*.md" -exec grep -l "```rust" {} \; | while read file; do
    echo "检查文件: $file"
    # 检查Rust代码示例是否有main函数
    if grep -q "```rust" "$file" && ! grep -q "fn main" "$file"; then
        echo "警告: $file 包含Rust代码但缺少main函数"
    fi
done

# 检查配置示例
echo "检查配置示例..."
find . -name "*.md" -exec grep -l "```toml\|```yaml\|```json" {} \; | while read file; do
    echo "检查文件: $file"
    # 检查配置示例是否完整
    if grep -q "```toml" "$file"; then
        if ! grep -q "\[dependencies\]" "$file"; then
            echo "警告: $file 包含TOML配置但可能不完整"
        fi
    fi
done

echo "内容检查完成"
```

### 4. 自动化检查脚本

#### 4.1 完整检查脚本

```bash
#!/bin/bash
# full_check.sh

echo "开始完整的文档质量检查..."

# 创建检查结果目录
mkdir -p check_results
timestamp=$(date +"%Y%m%d_%H%M%S")
result_dir="check_results/check_$timestamp"
mkdir -p "$result_dir"

# 运行所有检查
echo "1. 检查链接..."
./link_checker.sh > "$result_dir/link_check.log" 2>&1

echo "2. 检查格式..."
./format_checker.sh > "$result_dir/format_check.log" 2>&1

echo "3. 检查内容..."
./content_checker.sh > "$result_dir/content_check.log" 2>&1

echo "4. 运行markdownlint..."
markdownlint "**/*.md" > "$result_dir/markdownlint.log" 2>&1

echo "5. 运行拼写检查..."
cspell "**/*.md" > "$result_dir/spell_check.log" 2>&1

# 生成检查报告
echo "生成检查报告..."
cat > "$result_dir/check_report.md" << EOF
# 文档质量检查报告

**检查时间**: $(date)
**检查范围**: 所有markdown文档
**检查工具**: 自定义脚本 + markdownlint + cspell

## 检查结果

### 链接检查
\`\`\`
$(cat "$result_dir/link_check.log")
\`\`\`

### 格式检查
\`\`\`
$(cat "$result_dir/format_check.log")
\`\`\`

### 内容检查
\`\`\`
$(cat "$result_dir/content_check.log")
\`\`\`

### Markdownlint检查
\`\`\`
$(cat "$result_dir/markdownlint.log")
\`\`\`

### 拼写检查
\`\`\`
$(cat "$result_dir/spell_check.log")
\`\`\`

## 总结

检查完成，详细结果请查看各个日志文件。
EOF

echo "检查完成，结果保存在: $result_dir"
echo "查看报告: cat $result_dir/check_report.md"
```

#### 4.2 CI/CD集成脚本

```yaml
# .github/workflows/docs-check.yml
name: 文档质量检查

on:
  push:
    paths:
      - 'otlp/docs/**/*.md'
  pull_request:
    paths:
      - 'otlp/docs/**/*.md'

jobs:
  docs-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: 设置Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: 安装检查工具
      run: |
        npm install -g markdown-link-check
        npm install -g markdownlint-cli
        npm install -g cspell
    
    - name: 运行链接检查
      run: |
        find otlp/docs -name "*.md" -exec markdown-link-check {} \;
    
    - name: 运行格式检查
      run: |
        markdownlint "otlp/docs/**/*.md"
    
    - name: 运行拼写检查
      run: |
        cspell "otlp/docs/**/*.md"
    
    - name: 运行自定义检查
      run: |
        chmod +x otlp/docs/quality_check.sh
        ./otlp/docs/quality_check.sh
```

## 📊 检查标准

### 1. 链接质量标准

- **内部链接**: 所有内部链接必须有效
- **外部链接**: 外部链接应该可访问
- **锚点链接**: 锚点链接必须准确
- **相对路径**: 使用相对路径而非绝对路径

### 2. 格式质量标准

- **标题层级**: 使用正确的标题层级
- **代码块**: 使用正确的代码块格式
- **表格格式**: 使用规范的表格格式
- **列表格式**: 使用规范的列表格式

### 3. 内容质量标准

- **结构完整**: 文档结构完整
- **内容准确**: 内容准确无误
- **示例可运行**: 代码示例可运行
- **配置有效**: 配置示例有效

### 4. 拼写质量标准

- **拼写正确**: 所有单词拼写正确
- **术语一致**: 技术术语使用一致
- **语法正确**: 语法正确无误
- **标点规范**: 标点符号使用规范

## 🔧 配置文件

### 1. markdownlint配置

```json
{
  "default": true,
  "MD013": false,
  "MD033": false,
  "MD041": false,
  "MD024": false,
  "MD029": {
    "style": "ordered"
  }
}
```

### 2. cspell配置

```json
{
  "version": "0.2",
  "language": "en,zh",
  "words": [
    "OTLP",
    "OpenTelemetry",
    "gRPC",
    "Protobuf",
    "Rust",
    "Tokio",
    "async",
    "await",
    "telemetry",
    "observability",
    "microservices",
    "kubernetes",
    "docker",
    "helm",
    "istio",
    "prometheus",
    "grafana",
    "jaeger",
    "zipkin"
  ],
  "ignoreWords": [
    "config",
    "configs",
    "configurable"
  ],
  "import": [
    "@cspell/dict-rust/cspell-ext.json"
  ]
}
```

## 📋 使用指南

### 1. 本地检查

```bash
# 运行完整检查
./full_check.sh

# 运行单项检查
./link_checker.sh
./format_checker.sh
./content_checker.sh
```

### 2. 持续集成

- 在CI/CD流水线中集成检查脚本
- 设置检查失败时的处理策略
- 定期运行检查并生成报告

### 3. 团队协作

- 在提交前运行检查
- 设置pre-commit钩子
- 定期审查检查结果

## 📚 总结

通过使用这些质量检查工具，可以确保OTLP Rust项目文档的质量和一致性。建议：

1. **定期检查**: 定期运行质量检查
2. **自动化**: 在CI/CD中集成检查
3. **持续改进**: 根据检查结果持续改进
4. **团队培训**: 培训团队使用检查工具

---

**工具版本**: v1.0  
**创建时间**: 2025年1月27日  
**维护者**: OTLP文档团队  
**下次更新**: 2025年2月27日
