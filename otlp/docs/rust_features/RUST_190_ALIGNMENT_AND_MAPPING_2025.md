# 1. Rust 1.90 对标与项目特性映射（2025）

## 1.1 目录

1. 概述与结论
2. Rust 稳定版本现状与时间线
3. 语言与标准库特性对标清单
4. 本项目（`otlp`）实现特性映射
5. 风险点与兼容性策略
6. 后续升级与验证计划

## 1.2 概述与结论

1. 截至 2025-09，Rust 1.90 尚未稳定发布；最新稳定版为 1.89.x。本文以 1.89 为基线，给出 1.90 预期差异的占位与影响评估。
2. 本项目当前代码与文档宣称“Rust 1.90+”，经核验：以 1.89 稳定特性即可构建与运行；建议在 1.90 正式发布后进行一次最小变更的验证构建。

## 1.3 Rust 稳定版本现状与时间线

1. 当前稳定：1.89.x（2025-08 发布）。
2. 预计下一个稳定版本：1.90（预计 2025-10 左右，按 6 周节奏）。
3. 变更要点（以 1.89 公告为已知基线）：
   1. Lint：`mismatched_lifetime_syntaxes` 默认启用。
   2. 常量泛型：`_` 占位推断在更多情形可用。
   3. FFI：`i128`/`u128` 在 `extern "C"` 中更好支持。
   4. 标准库：若干 API 稳定（如 `Result::flatten` 等）。

注：1.90 具体条目以官方公告为准，发布后更新本表。

## 1.4 语言与标准库特性对标清单

1. 异步与并发
   1. async/await、`tokio` 运行时（生态层）。
   2. `Arc`、`RwLock`、原子类型；`Send`/`Sync` 约束。
2. 类型与内存
   1. 零拷贝倾向：`Arc<T>`/切片/借用。
   2. 枚举建模：强类型 `AttributeValue`、`TelemetryDataType`。
3. 常量泛型与推断（1.89 稳定范围内）。
4. FFI 与跨语言：C ABI 可选增强，不是本库核心路径。
5. 标准库新增稳定 API：在不破坏兼容的前提下按需采用。

结论：项目现有实现未使用不稳定特性；1.90 预计无需破坏性变更。

## 1.5 本项目（`otlp`）实现特性映射

1. 模块与职责
   1. `client`/`exporter`/`processor`/`transport`：分层清晰，对应文档《OTLP架构与设计组合方式深度分析》。
   2. `config`：批处理/重试/压缩/TLS 配置与构建器模式。
2. 异步模型
   1. `tokio` 驱动；并发发送、批量发送、重试（指数退避）。
   2. 指标任务使用 `tokio::spawn` 周期更新（见文档示例）。
3. 类型安全
   1. 强类型 `AttributeValue`、`MetricType`、`SpanKind` 等；编译期约束到位。
4. 性能取向
   1. 零拷贝与轻量克隆（通过 `Arc` 聚合）；连接池/压缩（Gzip/Brotli/Zstd）。
5. 兼容性
   1. 以 Rust 1.89 构建通过；1.90 发布后补充一次 CI 验证矩阵。

## 1.6 风险点与兼容性策略

1. 新 Lint 严格化可能引入编译告警：统一在 CI 以 `-D warnings` 驱动修正。
2. 常量泛型行为边界变化：对使用处加单元测试覆盖，避免 UB 类假设。
3. 第三方依赖上游破坏性升级：锁定次要版本，分支验证后再提升。

## 1.7 后续升级与验证计划

1. 待 1.90 发布 72 小时内：拉取 toolchain 进行 full build 与 test。
2. 基准与回归：运行 `cargo bench` 与集成测试对比基线。
3. 文档同步：将 README 徽标由“1.90+”改为“1.89+（已验证），1.90（已验证）”。
