# OpenTelemetry 语义约定标准

## 📊 语义约定概览

**创建时间**: 2025年1月27日  
**文档版本**: 1.0.0  
**维护者**: OpenTelemetry 2025 标准团队  
**状态**: 活跃开发中  

## 🎯 语义约定目标

### 主要目标

1. **标准化**: 建立标准化的语义约定
2. **一致性**: 确保跨系统的一致性
3. **互操作性**: 提升系统间互操作性
4. **可观测性**: 增强可观测性能力

### 成功标准

- **约定完整性**: 100%覆盖
- **标准化程度**: 完全标准化
- **一致性**: 跨系统一致
- **互操作性**: 完全互操作

## 🏗️ 语义约定架构

### 约定层次

```text
语义约定
├── 资源约定 (Resource Conventions)
│   ├── 服务信息
│   ├── 部署信息
│   ├── 主机信息
│   └── 云信息
├── 追踪约定 (Trace Conventions)
│   ├── HTTP约定
│   ├── 数据库约定
│   ├── RPC约定
│   └── 消息约定
├── 指标约定 (Metric Conventions)
│   ├── 系统指标
│   ├── 应用指标
│   ├── 业务指标
│   └── 自定义指标
└── 日志约定 (Log Conventions)
    ├── 日志级别
    ├── 错误信息
    ├── 结构化日志
    └── 上下文信息
```

### 约定原则

1. **命名规范**: 使用点分隔的层次化命名
2. **类型规范**: 明确的数据类型定义
3. **单位规范**: 标准的单位约定
4. **值规范**: 标准的值格式约定

## 📚 资源语义约定

### 1. 服务信息约定

#### 基本服务信息

```yaml
# 服务名称 - 必需
service.name: "user-service"
  type: string
  description: "服务名称，用于标识服务"
  examples: ["user-service", "payment-gateway", "auth-service"]

# 服务版本 - 推荐
service.version: "1.2.3"
  type: string
  description: "服务版本号"
  examples: ["1.2.3", "v2.1.0", "dev-1.0.0"]

# 服务实例ID - 推荐
service.instance.id: "user-service-1"
  type: string
  description: "服务实例的唯一标识符"
  examples: ["user-service-1", "payment-gateway-abc123"]

# 服务命名空间 - 可选
service.namespace: "production"
  type: string
  description: "服务命名空间"
  examples: ["production", "staging", "development"]
```

#### 服务元数据

```yaml
# 服务描述
service.description: "用户管理服务"
  type: string
  description: "服务的详细描述"

# 服务标签
service.tags: ["microservice", "user-management"]
  type: array<string>
  description: "服务标签列表"

# 服务所有者
service.owner: "platform-team"
  type: string
  description: "服务所有者或团队"
```

### 2. 部署信息约定

#### 部署环境

```yaml
# 部署环境 - 必需
deployment.environment: "production"
  type: string
  description: "部署环境"
  examples: ["production", "staging", "development", "testing"]

# 部署版本
deployment.version: "v1.2.3"
  type: string
  description: "部署版本"
  examples: ["v1.2.3", "2023-01-15", "build-123"]

# 部署名称
deployment.name: "user-service-deployment"
  type: string
  description: "部署名称"
  examples: ["user-service-deployment", "payment-gateway-prod"]

# 部署ID
deployment.id: "deployment-123"
  type: string
  description: "部署的唯一标识符"
```

#### 部署配置

```yaml
# 部署配置
deployment.config: "production-config"
  type: string
  description: "部署配置名称"

# 部署区域
deployment.region: "us-west-2"
  type: string
  description: "部署区域"
  examples: ["us-west-2", "eu-central-1", "ap-southeast-1"]

# 部署可用区
deployment.zone: "us-west-2a"
  type: string
  description: "部署可用区"
  examples: ["us-west-2a", "eu-central-1a", "ap-southeast-1a"]
```

### 3. 主机信息约定

#### 基本主机信息

```yaml
# 主机名称
host.name: "web-server-01"
  type: string
  description: "主机名称"
  examples: ["web-server-01", "db-server-prod", "api-gateway-1"]

# 主机ID
host.id: "host-123"
  type: string
  description: "主机的唯一标识符"
  examples: ["host-123", "i-1234567890abcdef0"]

# 主机类型
host.type: "ec2"
  type: string
  description: "主机类型"
  examples: ["ec2", "gce", "azure-vm", "bare-metal"]

# 主机架构
host.arch: "x86_64"
  type: string
  description: "主机架构"
  examples: ["x86_64", "arm64", "aarch64"]
```

#### 主机配置

```yaml
# 主机CPU核心数
host.cpu.count: 8
  type: int
  description: "CPU核心数"

# 主机内存大小
host.memory.total: 16777216
  type: int
  description: "总内存大小（KB）"

# 主机磁盘大小
host.disk.total: 1073741824
  type: int
  description: "总磁盘大小（KB）"

# 主机网络接口
host.network.interfaces: ["eth0", "eth1"]
  type: array<string>
  description: "网络接口列表"
```

### 4. 云信息约定

#### 云提供商信息

```yaml
# 云提供商
cloud.provider: "aws"
  type: string
  description: "云提供商"
  examples: ["aws", "gcp", "azure", "alibaba"]

# 云区域
cloud.region: "us-west-2"
  type: string
  description: "云区域"
  examples: ["us-west-2", "eu-central-1", "ap-southeast-1"]

# 云可用区
cloud.zone: "us-west-2a"
  type: string
  description: "云可用区"
  examples: ["us-west-2a", "eu-central-1a", "ap-southeast-1a"]

# 云账户ID
cloud.account.id: "123456789012"
  type: string
  description: "云账户ID"
```

#### 云资源信息

```yaml
# 云资源ID
cloud.resource.id: "i-1234567890abcdef0"
  type: string
  description: "云资源ID"

# 云资源类型
cloud.resource.type: "ec2"
  type: string
  description: "云资源类型"
  examples: ["ec2", "gce", "azure-vm", "container"]

# 云资源名称
cloud.resource.name: "web-server-01"
  type: string
  description: "云资源名称"

# 云资源标签
cloud.resource.tags: {"Environment": "production", "Team": "platform"}
  type: map<string, string>
  description: "云资源标签"
```

## 📊 追踪语义约定

### 1. HTTP约定

#### HTTP请求约定

```yaml
# HTTP方法
http.method: "GET"
  type: string
  description: "HTTP请求方法"
  examples: ["GET", "POST", "PUT", "DELETE", "PATCH"]

# HTTP URL
http.url: "https://api.example.com/users/123"
  type: string
  description: "完整的HTTP URL"
  examples: ["https://api.example.com/users/123", "http://localhost:8080/health"]

# HTTP状态码
http.status_code: 200
  type: int
  description: "HTTP响应状态码"
  examples: [200, 201, 400, 401, 404, 500]

# HTTP请求头
http.request.header.content-type: "application/json"
  type: string
  description: "HTTP请求头"
  examples: ["application/json", "text/html", "application/xml"]

# HTTP响应头
http.response.header.content-type: "application/json"
  type: string
  description: "HTTP响应头"
  examples: ["application/json", "text/html", "application/xml"]
```

#### HTTP客户端约定

```yaml
# HTTP客户端IP
http.client_ip: "192.168.1.100"
  type: string
  description: "HTTP客户端IP地址"

# HTTP用户代理
http.user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
  type: string
  description: "HTTP用户代理字符串"

# HTTP请求大小
http.request.body.size: 1024
  type: int
  description: "HTTP请求体大小（字节）"

# HTTP响应大小
http.response.body.size: 2048
  type: int
  description: "HTTP响应体大小（字节）"
```

### 2. 数据库约定

#### 数据库连接约定

```yaml
# 数据库系统
db.system: "postgresql"
  type: string
  description: "数据库系统"
  examples: ["postgresql", "mysql", "mongodb", "redis", "elasticsearch"]

# 数据库名称
db.name: "userdb"
  type: string
  description: "数据库名称"
  examples: ["userdb", "orders", "inventory", "analytics"]

# 数据库操作
db.operation: "SELECT"
  type: string
  description: "数据库操作类型"
  examples: ["SELECT", "INSERT", "UPDATE", "DELETE", "CREATE", "DROP"]

# 数据库语句
db.statement: "SELECT * FROM users WHERE id = ?"
  type: string
  description: "数据库语句"
  examples: ["SELECT * FROM users WHERE id = ?", "INSERT INTO orders VALUES (?, ?)"]
```

#### 数据库性能约定

```yaml
# 数据库连接池大小
db.connection_pool.size: 10
  type: int
  description: "数据库连接池大小"

# 数据库连接超时
db.connection.timeout: 5000
  type: int
  description: "数据库连接超时时间（毫秒）"

# 数据库查询超时
db.query.timeout: 30000
  type: int
  description: "数据库查询超时时间（毫秒）"

# 数据库事务ID
db.transaction.id: "tx-123"
  type: string
  description: "数据库事务ID"
```

### 3. RPC约定

#### gRPC约定

```yaml
# RPC系统
rpc.system: "grpc"
  type: string
  description: "RPC系统"
  examples: ["grpc", "thrift", "jsonrpc", "soap"]

# RPC服务
rpc.service: "UserService"
  type: string
  description: "RPC服务名称"
  examples: ["UserService", "PaymentService", "AuthService"]

# RPC方法
rpc.method: "GetUser"
  type: string
  description: "RPC方法名称"
  examples: ["GetUser", "CreateOrder", "ValidateToken"]

# gRPC状态码
rpc.grpc.status_code: 0
  type: int
  description: "gRPC状态码"
  examples: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
```

#### RPC性能约定

```yaml
# RPC请求大小
rpc.request.body.size: 1024
  type: int
  description: "RPC请求体大小（字节）"

# RPC响应大小
rpc.response.body.size: 2048
  type: int
  description: "RPC响应体大小（字节）"

# RPC超时时间
rpc.timeout: 5000
  type: int
  description: "RPC超时时间（毫秒）"

# RPC重试次数
rpc.retry.count: 3
  type: int
  description: "RPC重试次数"
```

### 4. 消息约定

#### 消息队列约定

```yaml
# 消息系统
messaging.system: "kafka"
  type: string
  description: "消息系统"
  examples: ["kafka", "rabbitmq", "activemq", "sqs", "pubsub"]

# 消息目标
messaging.destination: "user-events"
  type: string
  description: "消息目标"
  examples: ["user-events", "order-updates", "payment-notifications"]

# 消息操作
messaging.operation: "publish"
  type: string
  description: "消息操作"
  examples: ["publish", "consume", "create", "delete"]

# 消息ID
messaging.message.id: "msg-123"
  type: string
  description: "消息ID"
```

#### 消息性能约定

```yaml
# 消息大小
messaging.message.size: 1024
  type: int
  description: "消息大小（字节）"

# 消息分区
messaging.kafka.partition: 0
  type: int
  description: "Kafka分区号"

# 消息偏移量
messaging.kafka.offset: 12345
  type: int
  description: "Kafka偏移量"

# 消息时间戳
messaging.message.timestamp: 1640995200000
  type: int
  description: "消息时间戳（毫秒）"
```

## 📈 指标语义约定

### 1. 系统指标约定

#### CPU指标

```yaml
# CPU使用率
system.cpu.usage: 0.75
  type: double
  description: "CPU使用率（0-1）"
  unit: "1"

# CPU核心数
system.cpu.count: 8
  type: int
  description: "CPU核心数"
  unit: "1"

# CPU负载
system.cpu.load: 2.5
  type: double
  description: "CPU负载"
  unit: "1"
```

#### 内存指标

```yaml
# 内存使用量
system.memory.usage: 8589934592
  type: int
  description: "内存使用量（字节）"
  unit: "By"

# 内存总量
system.memory.total: 17179869184
  type: int
  description: "内存总量（字节）"
  unit: "By"

# 内存使用率
system.memory.usage_ratio: 0.5
  type: double
  description: "内存使用率（0-1）"
  unit: "1"
```

#### 磁盘指标

```yaml
# 磁盘使用量
system.disk.usage: 107374182400
  type: int
  description: "磁盘使用量（字节）"
  unit: "By"

# 磁盘总量
system.disk.total: 1073741824000
  type: int
  description: "磁盘总量（字节）"
  unit: "By"

# 磁盘I/O
system.disk.io.read: 1048576
  type: int
  description: "磁盘读取量（字节）"
  unit: "By"

system.disk.io.write: 2097152
  type: int
  description: "磁盘写入量（字节）"
  unit: "By"
```

#### 网络指标

```yaml
# 网络接收量
system.network.io.receive: 1048576
  type: int
  description: "网络接收量（字节）"
  unit: "By"

# 网络发送量
system.network.io.transmit: 2097152
  type: int
  description: "网络发送量（字节）"
  unit: "By"

# 网络连接数
system.network.connections: 100
  type: int
  description: "网络连接数"
  unit: "1"
```

### 2. 应用指标约定

#### HTTP指标

```yaml
# HTTP请求数
http.server.request.count: 1000
  type: int
  description: "HTTP请求数"
  unit: "1"

# HTTP请求持续时间
http.server.request.duration: 150
  type: int
  description: "HTTP请求持续时间（毫秒）"
  unit: "ms"

# HTTP请求大小
http.server.request.size: 1024
  type: int
  description: "HTTP请求大小（字节）"
  unit: "By"

# HTTP响应大小
http.server.response.size: 2048
  type: int
  description: "HTTP响应大小（字节）"
  unit: "By"
```

#### 数据库指标

```yaml
# 数据库连接数
db.connection.count: 10
  type: int
  description: "数据库连接数"
  unit: "1"

# 数据库查询数
db.query.count: 500
  type: int
  description: "数据库查询数"
  unit: "1"

# 数据库查询持续时间
db.query.duration: 25
  type: int
  description: "数据库查询持续时间（毫秒）"
  unit: "ms"

# 数据库事务数
db.transaction.count: 100
  type: int
  description: "数据库事务数"
  unit: "1"
```

### 3. 业务指标约定

#### 用户指标

```yaml
# 用户注册数
user.registration.count: 50
  type: int
  description: "用户注册数"
  unit: "1"

# 用户登录数
user.login.count: 200
  type: int
  description: "用户登录数"
  unit: "1"

# 活跃用户数
user.active.count: 1000
  type: int
  description: "活跃用户数"
  unit: "1"

# 用户会话持续时间
user.session.duration: 1800
  type: int
  description: "用户会话持续时间（秒）"
  unit: "s"
```

#### 订单指标

```yaml
# 订单创建数
order.created.count: 100
  type: int
  description: "订单创建数"
  unit: "1"

# 订单完成数
order.completed.count: 95
  type: int
  description: "订单完成数"
  unit: "1"

# 订单金额
order.amount.total: 10000
  type: double
  description: "订单总金额"
  unit: "USD"

# 订单处理时间
order.processing.duration: 300
  type: int
  description: "订单处理时间（秒）"
  unit: "s"
```

## 📝 日志语义约定

### 1. 日志级别约定

#### 标准日志级别

```yaml
# 日志级别
log.level: "INFO"
  type: string
  description: "日志级别"
  examples: ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"]

# 日志消息
log.message: "User login successful"
  type: string
  description: "日志消息内容"

# 日志时间戳
log.timestamp: 1640995200000
  type: int
  description: "日志时间戳（毫秒）"

# 日志来源
log.source: "user-service"
  type: string
  description: "日志来源"
```

#### 结构化日志约定

```yaml
# 日志ID
log.id: "log-123"
  type: string
  description: "日志唯一标识符"

# 日志标签
log.tags: ["user", "authentication"]
  type: array<string>
  description: "日志标签列表"

# 日志分类
log.category: "security"
  type: string
  description: "日志分类"
  examples: ["security", "performance", "business", "system"]
```

### 2. 错误信息约定

#### 错误基本信息

```yaml
# 错误名称
error.name: "ValidationError"
  type: string
  description: "错误名称"
  examples: ["ValidationError", "AuthenticationError", "DatabaseError"]

# 错误消息
error.message: "Invalid email format"
  type: string
  description: "错误消息"

# 错误类型
error.type: "client_error"
  type: string
  description: "错误类型"
  examples: ["client_error", "server_error", "network_error", "timeout_error"]

# 错误代码
error.code: "VALIDATION_001"
  type: string
  description: "错误代码"
```

#### 错误详细信息

```yaml
# 错误堆栈
error.stack: "ValidationError: Invalid email format\n    at validateEmail (validator.js:10:5)"
  type: string
  description: "错误堆栈信息"

# 错误文件
error.file: "validator.js"
  type: string
  description: "错误发生的文件"

# 错误行号
error.line: 10
  type: int
  description: "错误发生的行号"

# 错误列号
error.column: 5
  type: int
  description: "错误发生的列号"
```

### 3. 上下文信息约定

#### 请求上下文

```yaml
# 请求ID
request.id: "req-123"
  type: string
  description: "请求唯一标识符"

# 用户ID
user.id: "user-456"
  type: string
  description: "用户ID"

# 会话ID
session.id: "session-789"
  type: string
  description: "会话ID"

# 追踪ID
trace.id: "trace-abc"
  type: string
  description: "追踪ID"
```

#### 业务上下文

```yaml
# 业务ID
business.id: "order-123"
  type: string
  description: "业务ID"

# 业务类型
business.type: "order"
  type: string
  description: "业务类型"
  examples: ["order", "payment", "user", "product"]

# 业务状态
business.status: "completed"
  type: string
  description: "业务状态"
  examples: ["pending", "processing", "completed", "failed"]

# 业务金额
business.amount: 99.99
  type: double
  description: "业务金额"
  unit: "USD"
```

## 🚀 实施指南

### 1. 约定应用原则

#### 命名原则

1. **层次化命名**: 使用点分隔的层次化命名
2. **语义清晰**: 名称应该语义清晰，易于理解
3. **一致性**: 保持命名的一致性
4. **扩展性**: 支持未来的扩展需求

#### 类型原则

1. **类型明确**: 明确指定数据类型
2. **类型一致**: 保持类型的一致性
3. **类型验证**: 进行类型验证
4. **类型转换**: 支持类型转换

#### 单位原则

1. **标准单位**: 使用标准单位
2. **单位明确**: 明确指定单位
3. **单位一致**: 保持单位的一致性
4. **单位转换**: 支持单位转换

### 2. 约定实施步骤

#### 第一步：约定定义

1. **需求分析**: 分析业务需求
2. **约定设计**: 设计语义约定
3. **约定验证**: 验证约定设计
4. **约定文档**: 编写约定文档

#### 第二步：约定实现

1. **代码实现**: 实现约定逻辑
2. **测试验证**: 测试约定实现
3. **性能优化**: 优化约定性能
4. **错误处理**: 处理约定错误

#### 第三步：约定部署

1. **环境配置**: 配置部署环境
2. **约定部署**: 部署约定实现
3. **监控验证**: 监控约定运行
4. **问题修复**: 修复发现的问题

#### 第四步：约定维护

1. **定期审查**: 定期审查约定
2. **版本管理**: 管理约定版本
3. **向后兼容**: 保持向后兼容
4. **文档更新**: 更新约定文档

### 3. 约定最佳实践

#### 约定设计最佳实践

1. **简单明了**: 保持约定的简单明了
2. **向后兼容**: 保持向后兼容性
3. **扩展性**: 支持未来扩展
4. **一致性**: 保持约定一致性

#### 约定实现最佳实践

1. **性能优化**: 优化约定性能
2. **错误处理**: 完善错误处理
3. **日志记录**: 记录约定日志
4. **监控告警**: 设置监控告警

#### 约定维护最佳实践

1. **版本控制**: 使用版本控制
2. **文档更新**: 及时更新文档
3. **社区反馈**: 收集社区反馈
4. **持续改进**: 持续改进约定

## 🎉 总结

通过建立完整的语义约定标准，OpenTelemetry项目将：

1. **标准化**: 建立标准化的语义约定
2. **一致性**: 确保跨系统的一致性
3. **互操作性**: 提升系统间互操作性
4. **可观测性**: 增强可观测性能力

这个语义约定标准将显著提升遥测数据的标准化和一致性，为OpenTelemetry生态系统的发展奠定坚实基础。

---

**语义约定标准建立时间**: 2025年1月27日  
**文档版本**: 1.0.0  
**维护者**: OpenTelemetry 2025 标准团队  
**下次审查**: 2025年2月27日
