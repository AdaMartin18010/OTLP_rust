# Cargo 配置文件 - Rust 1.90 优化设置
# 2025年最新配置，支持Rust 1.90新特性和性能优化

[build]
# 构建优化设置
rustflags = [
    # CPU指令集优化 - 2025年最新设置
    "-C", "target-cpu=native",           # 针对当前CPU优化
    "-C", "target-feature=+crt-static",  # 静态链接C运行时
    "-C", "opt-level=3",                 # 最高优化级别
    "-C", "lto=fat",                     # 链接时优化
    "-C", "codegen-units=1",             # 单个代码生成单元
    "-C", "panic=abort",                 # panic时直接终止
    "-C", "strip=symbols",               # 去除调试符号
    
    # Rust 1.90 新特性优化
    "-C", "target-feature=+avx2,+fma",   # 启用AVX2和FMA指令
    "-C", "target-feature=+bmi2,+popcnt", # 启用BMI2和POPCNT指令
    "-C", "target-feature=+sse4.2",      # 启用SSE4.2指令集
    
    # 内存优化
    "-C", "force-frame-pointers=no",     # 禁用帧指针
    "-C", "relocation-model=static",     # 静态重定位模型
]

# 网络配置
[net]
retry = 2
git-fetch-with-cli = true

# 注册表配置
[registries.crates-io]
protocol = "sparse"

# 源配置 - 使用默认的 sparse 协议
# [source.crates-io] 配置已移除，使用默认设置

# 环境变量
[env]
# Rust 1.90 优化环境变量
RUST_LOG = "info"
CARGO_INCREMENTAL = "1"
CARGO_NET_RETRY = "2"

# 目标配置
[target.x86_64-pc-windows-msvc]
rustflags = [
    "-C", "target-cpu=native",
    "-C", "target-feature=+crt-static",
]

[target.x86_64-unknown-linux-gnu]
rustflags = [
    "-C", "target-cpu=native",
    "-C", "target-feature=+crt-static",
    "-C", "link-arg=-static",
]

[target.aarch64-unknown-linux-gnu]
rustflags = [
    "-C", "target-cpu=native",
    "-C", "target-feature=+crt-static",
    "-C", "link-arg=-static",
]

# 别名配置 - 精简版，保留最常用的别名
[alias]
# 开发别名
dev = "run --bin"
test-lib = "test --lib"
check-all = "check --all-targets"
build-release = "build --release"

# 性能测试别名
bench-all = "bench --all"
profile = "build --release --profile=bench"

# 清理别名
clean-all = "clean && cargo clean --target-dir"

# 更新别名
update-all = "update && cargo update --workspace"

# 安全检查别名
audit = "audit --deny warnings"
security = "audit --deny warnings && cargo deny check"

# 文档生成别名
docs = "doc --all --no-deps --open"
docs-all = "doc --all --no-deps --document-private-items --open"

# 格式化别名
fmt-all = "fmt --all"
fmt-check = "fmt --all -- --check"

# 代码检查别名
clippy-all = "clippy --all-targets --all-features -- -D warnings"
clippy-pedantic = "clippy --all-targets --all-features -- -W clippy::pedantic -W clippy::nursery -W clippy::cargo"

# 测试别名
test-all = "test --all --all-features"
test-integration = "test --test"
test-unit = "test --lib --bins"

# 发布别名
publish-check = "publish --all --dry-run"
release = "build --release && cargo test --release"

# 工作区别名
ws-build = "build --workspace"
ws-test = "test --workspace"
ws-check = "check --workspace"
ws-clippy = "clippy --workspace --all-targets --all-features -- -D warnings"

# 依赖管理别名
deps = "tree --duplicates"
deps-update = "update --workspace"
deps-outdated = "outdated --workspace"

# 性能分析别名
perf = "build --release --profile=bench && cargo bench"

# 跨平台编译别名
cross-build = "build --target"
cross-test = "test --target"
