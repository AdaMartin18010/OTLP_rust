# OpenTelemetry Protocol (OTLP) ç»Ÿä¸€è§„èŒƒè¯¦è§£

**ç‰ˆæœ¬**: 2.1.0  
**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ27æ—¥  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ27æ—¥  
**Rust ç‰ˆæœ¬**: 1.90.0  
**çŠ¶æ€**: ğŸŸ¢ æ´»è·ƒç»´æŠ¤

> **ç®€ä»‹**: OTLP åè®®çš„å®Œæ•´æŠ€æœ¯è§„èŒƒè¯´æ˜ï¼ŒåŒ…å«åè®®æ¶æ„ã€æ•°æ®æ¨¡å‹ã€ä¼ è¾“æœºåˆ¶å’Œå®æ–½æŒ‡å—ã€‚æœ¬æ–‡æ¡£æ•´åˆäº†å¤šä¸ªé‡å¤è§„èŒƒæ–‡æ¡£ï¼Œæä¾›ç»Ÿä¸€æƒå¨çš„ OTLP è§„èŒƒå‚è€ƒã€‚

> **æƒå¨æ¥æºä¸å®ç°å¯¹é½**:  
> - æƒå¨å®šä¹‰å…¥å£ï¼šæœ¬æ–‡ä»¶ï¼ˆç»Ÿä¸€è§„èŒƒè¯¦è§£ï¼‰
> - ä»£ç æ˜ å°„ï¼šå‚è§ `OTLP_2025_COMPREHENSIVE_DOCUMENTATION_INDEX.md` çš„"è§„èŒƒ-å®ç°å¯¹é½çŸ©é˜µ"ç« èŠ‚
> - æºç è·³è½¬ï¼š`otlp/src/data.rs`, `otlp/src/transport.rs`, `otlp/src/protobuf.rs`, `otlp/src/exporter.rs`

---

## ğŸ“‹ ç›®å½•

- [OpenTelemetry Protocol (OTLP) ç»Ÿä¸€è§„èŒƒè¯¦è§£](#opentelemetry-protocol-otlp-ç»Ÿä¸€è§„èŒƒè¯¦è§£)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. OTLP è§„èŒƒæ¦‚è§ˆ](#1-otlp-è§„èŒƒæ¦‚è§ˆ)
    - [1.1 è§„èŒƒç›®æ ‡](#11-è§„èŒƒç›®æ ‡)
    - [1.2 æˆåŠŸæ ‡å‡†](#12-æˆåŠŸæ ‡å‡†)
    - [1.3 é€‚ç”¨èŒƒå›´](#13-é€‚ç”¨èŒƒå›´)
  - [2. OTLP åè®®æ¶æ„](#2-otlp-åè®®æ¶æ„)
    - [2.1 åè®®å±‚æ¬¡](#21-åè®®å±‚æ¬¡)
    - [2.2 æ ¸å¿ƒç‰¹æ€§](#22-æ ¸å¿ƒç‰¹æ€§)
    - [2.3 æ¶æ„åŸåˆ™](#23-æ¶æ„åŸåˆ™)
  - [3. æ•°æ®æ¨¡å‹è§„èŒƒ](#3-æ•°æ®æ¨¡å‹è§„èŒƒ)
    - [3.1 è¿½è¸ªæ•°æ®ï¼ˆTracesï¼‰](#31-è¿½è¸ªæ•°æ®traces)
    - [3.2 æŒ‡æ ‡æ•°æ®ï¼ˆMetricsï¼‰](#32-æŒ‡æ ‡æ•°æ®metrics)
    - [3.3 æ—¥å¿—æ•°æ®ï¼ˆLogsï¼‰](#33-æ—¥å¿—æ•°æ®logs)
    - [3.4 èµ„æºæ¨¡å‹ï¼ˆResourceï¼‰](#34-èµ„æºæ¨¡å‹resource)
    - [3.5 å±æ€§ç³»ç»Ÿï¼ˆAttributesï¼‰](#35-å±æ€§ç³»ç»Ÿattributes)
  - [4. ä¼ è¾“åè®®è§„èŒƒ](#4-ä¼ è¾“åè®®è§„èŒƒ)
    - [4.1 gRPC ä¼ è¾“](#41-grpc-ä¼ è¾“)
    - [4.2 HTTP/1.1 ä¼ è¾“](#42-http11-ä¼ è¾“)
    - [4.3 HTTP/2 ä¼ è¾“](#43-http2-ä¼ è¾“)
    - [4.4 å‹ç¼©å’Œç¼–ç ](#44-å‹ç¼©å’Œç¼–ç )
  - [5. Protocol Buffers å®šä¹‰](#5-protocol-buffers-å®šä¹‰)
    - [5.1 æ¶ˆæ¯ç»“æ„](#51-æ¶ˆæ¯ç»“æ„)
    - [5.2 å­—æ®µå®šä¹‰](#52-å­—æ®µå®šä¹‰)
    - [5.3 ç‰ˆæœ¬å…¼å®¹æ€§](#53-ç‰ˆæœ¬å…¼å®¹æ€§)
  - [6. å®‰å…¨æ€§è§„èŒƒ](#6-å®‰å…¨æ€§è§„èŒƒ)
    - [6.1 ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰](#61-ä¼ è¾“å±‚å®‰å…¨tls)
    - [6.2 èº«ä»½è®¤è¯](#62-èº«ä»½è®¤è¯)
    - [6.3 æˆæƒæœºåˆ¶](#63-æˆæƒæœºåˆ¶)
  - [7. æ€§èƒ½ä¼˜åŒ–](#7-æ€§èƒ½ä¼˜åŒ–)
    - [7.1 æ‰¹å¤„ç†ç­–ç•¥](#71-æ‰¹å¤„ç†ç­–ç•¥)
    - [7.2 å‹ç¼©ç®—æ³•](#72-å‹ç¼©ç®—æ³•)
    - [7.3 è¿æ¥ç®¡ç†](#73-è¿æ¥ç®¡ç†)
  - [8. é”™è¯¯å¤„ç†](#8-é”™è¯¯å¤„ç†)
    - [8.1 é”™è¯¯ä»£ç ](#81-é”™è¯¯ä»£ç )
    - [8.2 é‡è¯•ç­–ç•¥](#82-é‡è¯•ç­–ç•¥)
    - [8.3 ç†”æ–­æœºåˆ¶](#83-ç†”æ–­æœºåˆ¶)
  - [9. å®æ–½æŒ‡å—](#9-å®æ–½æŒ‡å—)
    - [9.1 å®¢æˆ·ç«¯å®ç°](#91-å®¢æˆ·ç«¯å®ç°)
    - [9.2 æœåŠ¡ç«¯å®ç°](#92-æœåŠ¡ç«¯å®ç°)
    - [9.3 æµ‹è¯•éªŒè¯](#93-æµ‹è¯•éªŒè¯)
  - [10. ç‰ˆæœ¬å…¼å®¹æ€§](#10-ç‰ˆæœ¬å…¼å®¹æ€§)
    - [10.1 åè®®ç‰ˆæœ¬](#101-åè®®ç‰ˆæœ¬)
    - [10.2 å‘åå…¼å®¹](#102-å‘åå…¼å®¹)
    - [10.3 å‡çº§è·¯å¾„](#103-å‡çº§è·¯å¾„)
  - [é™„å½• A: å®Œæ•´ç¤ºä¾‹](#é™„å½•-a-å®Œæ•´ç¤ºä¾‹)
  - [é™„å½• B: å‚è€ƒèµ„æ–™](#é™„å½•-b-å‚è€ƒèµ„æ–™)

---

## 1. OTLP è§„èŒƒæ¦‚è§ˆ

### 1.1 è§„èŒƒç›®æ ‡

OTLPï¼ˆOpenTelemetry Protocolï¼‰è§„èŒƒçš„ä¸»è¦ç›®æ ‡ï¼š

1. **åè®®æ ‡å‡†åŒ–**: å»ºç«‹ç»Ÿä¸€çš„é¥æµ‹æ•°æ®åè®®
   - å®šä¹‰æ ‡å‡†çš„æ•°æ®äº¤æ¢æ ¼å¼
   - ç¡®ä¿è·¨è¯­è¨€ã€è·¨å¹³å°äº’æ“ä½œæ€§
   - æä¾›æ¸…æ™°çš„åè®®æ¼”è¿›è·¯å¾„

2. **æ•°æ®æ¨¡å‹ç»Ÿä¸€**: å®šä¹‰æ ‡å‡†çš„æ•°æ®æ¨¡å‹
   - Tracesï¼ˆè¿½è¸ªï¼‰ã€Metricsï¼ˆæŒ‡æ ‡ï¼‰ã€Logsï¼ˆæ—¥å¿—ï¼‰ä¸‰å¤§æ”¯æŸ±
   - ç»Ÿä¸€çš„èµ„æºå’Œå±æ€§æ¨¡å‹
   - å¯æ‰©å±•çš„æ•°æ®ç»“æ„

3. **ä¼ è¾“åè®®æ”¯æŒ**: æ”¯æŒå¤šç§ä¼ è¾“åè®®
   - gRPC ä½œä¸ºé¦–é€‰åè®®ï¼ˆé«˜æ€§èƒ½ï¼‰
   - HTTP/1.1 å’Œ HTTP/2 æ”¯æŒï¼ˆå¹¿æ³›å…¼å®¹ï¼‰
   - è‡ªå®šä¹‰ä¼ è¾“åè®®æ‰©å±•

4. **äº’æ“ä½œæ€§ä¿è¯**: ç¡®ä¿ç³»ç»Ÿé—´äº’æ“ä½œæ€§
   - æ˜ç¡®çš„åè®®è§„èŒƒ
   - å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
   - å‚è€ƒå®ç°

5. **ç‰ˆæœ¬å…¼å®¹æ€§**: ä¿è¯å‘åå…¼å®¹æ€§
   - è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
   - æ¸è¿›å¼ç‰¹æ€§æ·»åŠ 
   - åºŸå¼ƒç‰¹æ€§çš„è¿‡æ¸¡æœŸ

### 1.2 æˆåŠŸæ ‡å‡†

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰çŠ¶æ€ |
|------|------|---------|
| **åè®®å®Œæ•´æ€§** | 100% | âœ… å®Œæ•´ |
| **æ•°æ®æ¨¡å‹** | æ ‡å‡†åŒ– | âœ… å·²æ ‡å‡†åŒ– |
| **ä¼ è¾“æ”¯æŒ** | å¤šåè®® | âœ… gRPC + HTTP |
| **äº’æ“ä½œæ€§** | å®Œå…¨äº’æ“ä½œ | âœ… å·²éªŒè¯ |
| **å…¼å®¹æ€§** | å‘åå…¼å®¹ | âœ… ä¿è¯å…¼å®¹ |

### 1.3 é€‚ç”¨èŒƒå›´

æœ¬è§„èŒƒé€‚ç”¨äºï¼š

- **å®¢æˆ·ç«¯åº“**: å„ç¼–ç¨‹è¯­è¨€çš„ OTLP å®¢æˆ·ç«¯å®ç°
- **æœåŠ¡ç«¯**: OTLP Collector å’Œåç«¯æœåŠ¡
- **ç½‘å…³**: åè®®è½¬æ¢å’Œä»£ç†æœåŠ¡
- **å·¥å…·**: å¼€å‘ã€æµ‹è¯•å’Œç›‘æ§å·¥å…·

---

## 2. OTLP åè®®æ¶æ„

### 2.1 åè®®å±‚æ¬¡

OTLP åè®®é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Traces   â”‚  â”‚  Metrics  â”‚  â”‚   Logs    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚        Resource & Attributes          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åè®®å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚      OTLP åè®®å®šä¹‰ (Protobuf)         â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚      æ•°æ®åºåˆ—åŒ–ä¸ååºåˆ—åŒ–              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¼ è¾“å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  gRPC    â”‚  â”‚ HTTP/1.1 â”‚  â”‚ HTTP/2   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç½‘ç»œå±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  TCP/IP  â”‚  â”‚ TLS/SSL  â”‚  â”‚  HTTP/3  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç‰¹æ€§

#### 2.2.1 æ ‡å‡†åŒ–æ•°æ®æ ¼å¼

- **Protocol Buffers å®šä¹‰**: è·¨è¯­è¨€çš„äºŒè¿›åˆ¶åºåˆ—åŒ–æ ¼å¼
- **è·¨è¯­è¨€æ”¯æŒ**: æ‰€æœ‰ä¸»æµç¼–ç¨‹è¯­è¨€
- **ç‰ˆæœ¬åŒ–å…¼å®¹**: è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
- **å‘åå…¼å®¹ä¿è¯**: æ—§ç‰ˆæœ¬å®¢æˆ·ç«¯å¯ä¸æ–°ç‰ˆæœ¬æœåŠ¡ç«¯é€šä¿¡

#### 2.2.2 å¤šä¼ è¾“åè®®æ”¯æŒ

| ä¼ è¾“åè®® | ç‰¹æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| **gRPC** | é«˜æ€§èƒ½ã€åŒå‘æµã€å¤šè·¯å¤ç”¨ | ç”Ÿäº§ç¯å¢ƒé¦–é€‰ |
| **HTTP/1.1** | å¹¿æ³›æ”¯æŒã€ç®€å•æ˜“ç”¨ | å…¼å®¹æ€§è¦æ±‚é«˜ |
| **HTTP/2** | å¤šè·¯å¤ç”¨ã€æœåŠ¡å™¨æ¨é€ | ç°ä»£åŒ–éƒ¨ç½² |

#### 2.2.3 æ•°æ®ç±»å‹æ”¯æŒ

- **Traces**: åˆ†å¸ƒå¼è¿½è¸ªæ•°æ®ï¼ˆSpan æ¨¡å‹ï¼‰
- **Metrics**: æ€§èƒ½æŒ‡æ ‡æ•°æ®ï¼ˆCounterã€Gaugeã€Histogram ç­‰ï¼‰
- **Logs**: ç»“æ„åŒ–æ—¥å¿—æ•°æ®ï¼ˆLogRecord æ¨¡å‹ï¼‰

#### 2.2.4 é«˜çº§ç‰¹æ€§

- **å‹ç¼©æ”¯æŒ**: gzipã€snappyã€zstd
- **æ‰¹å¤„ç†**: æ‰¹é‡å‘é€å‡å°‘ç½‘ç»œå¼€é”€
- **é‡è¯•æœºåˆ¶**: æ™ºèƒ½é‡è¯•ä¿è¯å¯é æ€§
- **ç†”æ–­å™¨**: é˜²æ­¢çº§è”æ•…éšœ
- **èƒŒå‹æ§åˆ¶**: æµé‡æ§åˆ¶æœºåˆ¶

### 2.3 æ¶æ„åŸåˆ™

1. **æ€§èƒ½ä¼˜å…ˆ**: é«˜ååé‡ã€ä½å»¶è¿Ÿ
2. **å¯é æ€§**: æ•°æ®ä¸ä¸¢å¤±ã€é”™è¯¯å¯æ¢å¤
3. **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°ç‰¹æ€§
4. **äº’æ“ä½œæ€§**: è·¨è¯­è¨€ã€è·¨å¹³å°å…¼å®¹
5. **ç®€æ´æ€§**: æ˜“äºç†è§£å’Œå®ç°

---

## 3. æ•°æ®æ¨¡å‹è§„èŒƒ

### 3.1 è¿½è¸ªæ•°æ®ï¼ˆTracesï¼‰

#### 3.1.1 Span æ¨¡å‹

```protobuf
message Span {
  bytes trace_id = 1;              // è¿½è¸ª ID (16 bytes)
  bytes span_id = 2;               // Span ID (8 bytes)
  string trace_state = 3;          // è¿½è¸ªçŠ¶æ€
  bytes parent_span_id = 4;        // çˆ¶ Span ID
  string name = 5;                 // Span åç§°
  SpanKind kind = 6;               // Span ç±»å‹
  fixed64 start_time_unix_nano = 7;// å¼€å§‹æ—¶é—´ï¼ˆçº³ç§’ï¼‰
  fixed64 end_time_unix_nano = 8;  // ç»“æŸæ—¶é—´ï¼ˆçº³ç§’ï¼‰
  repeated KeyValue attributes = 9;// å±æ€§åˆ—è¡¨
  uint32 dropped_attributes_count = 10;
  repeated Event events = 11;      // äº‹ä»¶åˆ—è¡¨
  uint32 dropped_events_count = 12;
  repeated Link links = 13;        // é“¾æ¥åˆ—è¡¨
  uint32 dropped_links_count = 14;
  Status status = 15;              // çŠ¶æ€ä¿¡æ¯
}
```

#### 3.1.2 Span ç±»å‹

```rust
pub enum SpanKind {
    Unspecified = 0,  // æœªæŒ‡å®š
    Internal = 1,     // å†…éƒ¨æ“ä½œ
    Server = 2,       // æœåŠ¡ç«¯æ¥æ”¶
    Client = 3,       // å®¢æˆ·ç«¯è°ƒç”¨
    Producer = 4,     // æ¶ˆæ¯ç”Ÿäº§è€…
    Consumer = 5,     // æ¶ˆæ¯æ¶ˆè´¹è€…
}
```

#### 3.1.3 ä½¿ç”¨ç¤ºä¾‹

```rust
use otlp::trace::{Span, SpanKind};

// åˆ›å»º Span
let span = Span::builder("my_operation")
    .with_kind(SpanKind::Server)
    .with_attribute("http.method", "GET")
    .with_attribute("http.url", "/api/users")
    .start();

// ... æ‰§è¡Œæ“ä½œ ...

span.end();
```

### 3.2 æŒ‡æ ‡æ•°æ®ï¼ˆMetricsï¼‰

#### 3.2.1 æŒ‡æ ‡ç±»å‹

```text
Metrics ç±»å‹
â”œâ”€â”€ Gaugeï¼ˆç¬æ—¶å€¼ï¼‰
â”‚   â””â”€â”€ ç¤ºä¾‹ï¼šCPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡
â”œâ”€â”€ Counterï¼ˆç´¯åŠ è®¡æ•°å™¨ï¼‰
â”‚   â””â”€â”€ ç¤ºä¾‹ï¼šè¯·æ±‚æ€»æ•°ã€é”™è¯¯æ€»æ•°
â”œâ”€â”€ Histogramï¼ˆç›´æ–¹å›¾ï¼‰
â”‚   â””â”€â”€ ç¤ºä¾‹ï¼šè¯·æ±‚å»¶è¿Ÿåˆ†å¸ƒ
â””â”€â”€ Summaryï¼ˆæ‘˜è¦ï¼‰
    â””â”€â”€ ç¤ºä¾‹ï¼šè¯·æ±‚å»¶è¿Ÿçš„ç™¾åˆ†ä½æ•°
```

#### 3.2.2 Metric æ•°æ®ç»“æ„

```protobuf
message Metric {
  string name = 1;                  // æŒ‡æ ‡åç§°
  string description = 2;           // æŒ‡æ ‡æè¿°
  string unit = 3;                  // å•ä½
  oneof data {
    Gauge gauge = 4;
    Sum sum = 5;
    Histogram histogram = 6;
    ExponentialHistogram exponential_histogram = 7;
    Summary summary = 8;
  }
}
```

#### 3.2.3 ä½¿ç”¨ç¤ºä¾‹

```rust
use otlp::metrics::{Counter, Histogram};

// è®¡æ•°å™¨
let counter = Counter::new("http_requests_total")
    .with_description("Total HTTP requests")
    .with_unit("1");

counter.add(1, &[("method", "GET"), ("status", "200")]);

// ç›´æ–¹å›¾
let histogram = Histogram::new("http_request_duration_seconds")
    .with_description("HTTP request duration")
    .with_unit("s");

histogram.record(0.042, &[("method", "GET")]);
```

### 3.3 æ—¥å¿—æ•°æ®ï¼ˆLogsï¼‰

#### 3.3.1 LogRecord ç»“æ„

```protobuf
message LogRecord {
  fixed64 time_unix_nano = 1;       // æ—¶é—´æˆ³ï¼ˆçº³ç§’ï¼‰
  fixed64 observed_time_unix_nano = 2;
  SeverityNumber severity_number = 3;// ä¸¥é‡çº§åˆ«ï¼ˆæ•°å€¼ï¼‰
  string severity_text = 4;          // ä¸¥é‡çº§åˆ«ï¼ˆæ–‡æœ¬ï¼‰
  AnyValue body = 5;                 // æ—¥å¿—ä¸»ä½“
  repeated KeyValue attributes = 6;  // å±æ€§
  uint32 dropped_attributes_count = 7;
  uint32 flags = 8;                  // æ ‡å¿—ä½
  bytes trace_id = 9;                // å…³è”çš„ Trace ID
  bytes span_id = 10;                // å…³è”çš„ Span ID
}
```

#### 3.3.2 ä¸¥é‡çº§åˆ«

```rust
pub enum SeverityNumber {
    Unspecified = 0,
    Trace = 1,    // TRACE (1-4)
    Debug = 5,    // DEBUG (5-8)
    Info = 9,     // INFO (9-12)
    Warn = 13,    // WARN (13-16)
    Error = 17,   // ERROR (17-20)
    Fatal = 21,   // FATAL (21-24)
}
```

### 3.4 èµ„æºæ¨¡å‹ï¼ˆResourceï¼‰

#### 3.4.1 Resource å®šä¹‰

```protobuf
message Resource {
  repeated KeyValue attributes = 1;  // èµ„æºå±æ€§
  uint32 dropped_attributes_count = 2;
}
```

#### 3.4.2 æ ‡å‡†èµ„æºå±æ€§

```yaml
# æœåŠ¡ä¿¡æ¯
service.name: "my-service"
service.version: "1.0.0"
service.instance.id: "instance-1"

# éƒ¨ç½²ç¯å¢ƒ
deployment.environment: "production"
cloud.provider: "aws"
cloud.region: "us-west-2"

# ä¸»æœºä¿¡æ¯
host.name: "server-01"
host.arch: "amd64"
os.type: "linux"
```

### 3.5 å±æ€§ç³»ç»Ÿï¼ˆAttributesï¼‰

#### 3.5.1 KeyValue å®šä¹‰

```protobuf
message KeyValue {
  string key = 1;
  AnyValue value = 2;
}

message AnyValue {
  oneof value {
    string string_value = 1;
    bool bool_value = 2;
    int64 int_value = 3;
    double double_value = 4;
    ArrayValue array_value = 5;
    KeyValueList kvlist_value = 6;
    bytes bytes_value = 7;
    }
}
```

---

## 4. ä¼ è¾“åè®®è§„èŒƒ

### 4.1 gRPC ä¼ è¾“

#### 4.1.1 æœåŠ¡å®šä¹‰

```protobuf
service TraceService {
  rpc Export(ExportTraceServiceRequest) returns (ExportTraceServiceResponse) {}
}

service MetricsService {
  rpc Export(ExportMetricsServiceRequest) returns (ExportMetricsServiceResponse) {}
}

service LogsService {
  rpc Export(ExportLogsServiceRequest) returns (ExportLogsServiceResponse) {}
}
```

#### 4.1.2 ç«¯ç‚¹é…ç½®

```yaml
# gRPC ç«¯ç‚¹
endpoint: "https://otlp.example.com:4317"

# å®‰å…¨é…ç½®
tls:
  enabled: true
  cert_file: "/path/to/cert.pem"
  key_file: "/path/to/key.pem"
  ca_file: "/path/to/ca.pem"

# è®¤è¯
headers:
  authorization: "Bearer ${API_KEY}"
```

### 4.2 HTTP/1.1 ä¼ è¾“

#### 4.2.1 HTTP ç«¯ç‚¹

```text
POST /v1/traces HTTP/1.1
POST /v1/metrics HTTP/1.1
POST /v1/logs HTTP/1.1
```

#### 4.2.2 HTTP å¤´éƒ¨

```http
Content-Type: application/x-protobuf
Content-Encoding: gzip
Authorization: Bearer <token>
```

#### 4.2.3 å“åº”çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ | å¤„ç†å»ºè®® |
|-------|------|---------|
| 200 | æˆåŠŸ | ç»§ç»­ |
| 400 | è¯·æ±‚é”™è¯¯ | æ£€æŸ¥æ•°æ®æ ¼å¼ |
| 401 | æœªæˆæƒ | æ£€æŸ¥è®¤è¯ä¿¡æ¯ |
| 429 | é™æµ | æŒ‡æ•°é€€é¿é‡è¯• |
| 500 | æœåŠ¡å™¨é”™è¯¯ | é‡è¯• |
| 503 | æœåŠ¡ä¸å¯ç”¨ | é‡è¯• |

### 4.3 HTTP/2 ä¼ è¾“

HTTP/2 ä¼ è¾“æ”¯æŒï¼š
- âœ… å¤šè·¯å¤ç”¨
- âœ… æœåŠ¡å™¨æ¨é€
- âœ… å¤´éƒ¨å‹ç¼©
- âœ… äºŒè¿›åˆ¶å¸§

### 4.4 å‹ç¼©å’Œç¼–ç 

#### 4.4.1 æ”¯æŒçš„å‹ç¼©ç®—æ³•

```text
å‹ç¼©ç®—æ³•
â”œâ”€â”€ gzip (æ¨è)
â”‚   â””â”€â”€ å‹ç¼©ç‡: çº¦ 70-80%
â”œâ”€â”€ snappy
â”‚   â””â”€â”€ é€Ÿåº¦å¿«ï¼Œå‹ç¼©ç‡ä¸­ç­‰
â””â”€â”€ zstd (æœ€ä½³)
    â””â”€â”€ å‹ç¼©ç‡å’Œé€Ÿåº¦å¹³è¡¡
```

#### 4.4.2 é…ç½®ç¤ºä¾‹

```rust
use otlp::exporter::Compression;

let exporter = OtlpExporter::builder()
    .with_compression(Compression::Gzip)
    .with_endpoint("https://otlp.example.com:4317")
    .build()?;
```

---

## 5. Protocol Buffers å®šä¹‰

### 5.1 æ¶ˆæ¯ç»“æ„

å®Œæ•´çš„ Protocol Buffers å®šä¹‰å‚è§ï¼š
- [opentelemetry-proto GitHub](https://github.com/open-telemetry/opentelemetry-proto)

### 5.2 å­—æ®µå®šä¹‰

æ‰€æœ‰å­—æ®µéµå¾ª Protocol Buffers è§„èŒƒï¼š
- å­—æ®µç¼–å·1-15ä½¿ç”¨1å­—èŠ‚ç¼–ç 
- å­—æ®µç¼–å·16-2047ä½¿ç”¨2å­—èŠ‚ç¼–ç 
- ä¿ç•™å­—æ®µç”¨äºæœªæ¥æ‰©å±•

### 5.3 ç‰ˆæœ¬å…¼å®¹æ€§

- âœ… å‘åå…¼å®¹ï¼šæ–°å­—æ®µä½¿ç”¨æ–°ç¼–å·
- âœ… åºŸå¼ƒå­—æ®µï¼šæ ‡è®°ä¸º `deprecated`
- âœ… ä¿ç•™å­—æ®µï¼šä½¿ç”¨ `reserved` å…³é”®å­—

---

## 6. å®‰å…¨æ€§è§„èŒƒ

### 6.1 ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰

#### 6.1.1 TLS é…ç½®

```yaml
tls:
  enabled: true
  min_version: "1.2"
  max_version: "1.3"
  cipher_suites:
    - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
    - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
```

#### 6.1.2 è¯ä¹¦éªŒè¯

- âœ… éªŒè¯æœåŠ¡å™¨è¯ä¹¦
- âœ… éªŒè¯è¯ä¹¦é“¾
- âœ… æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
- âœ… éªŒè¯ä¸»æœºå

### 6.2 èº«ä»½è®¤è¯

#### 6.2.1 æ”¯æŒçš„è®¤è¯æ–¹å¼

```text
è®¤è¯æ–¹å¼
â”œâ”€â”€ API Keyï¼ˆç®€å•ï¼‰
â”‚   â””â”€â”€ Header: Authorization: Bearer <key>
â”œâ”€â”€ mTLSï¼ˆåŒå‘è®¤è¯ï¼‰
â”‚   â””â”€â”€ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒå‘è¯ä¹¦éªŒè¯
â”œâ”€â”€ OAuth 2.0ï¼ˆæ ‡å‡†ï¼‰
â”‚   â””â”€â”€ Token åˆ·æ–°æœºåˆ¶
â””â”€â”€ è‡ªå®šä¹‰è®¤è¯
    â””â”€â”€ æ‰©å±•å¤´éƒ¨
```

### 6.3 æˆæƒæœºåˆ¶

- RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰
- ABACï¼ˆåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼‰
- è‡ªå®šä¹‰ç­–ç•¥

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 æ‰¹å¤„ç†ç­–ç•¥

```rust
let batch_config = BatchConfig {
    max_queue_size: 2048,
    scheduled_delay_millis: 5000,
    max_export_batch_size: 512,
    max_export_timeout_millis: 30000,
};
```

### 7.2 å‹ç¼©ç®—æ³•

| ç®—æ³• | å‹ç¼©ç‡ | é€Ÿåº¦ | æ¨èåœºæ™¯ |
|------|--------|------|---------|
| **gzip** | é«˜ | ä¸­ç­‰ | é€šç”¨åœºæ™¯ |
| **snappy** | ä¸­ç­‰ | å¿« | ä½å»¶è¿Ÿè¦æ±‚ |
| **zstd** | å¾ˆé«˜ | å¿« | é«˜ååé‡ |

### 7.3 è¿æ¥ç®¡ç†

- **è¿æ¥æ± **: å¤ç”¨è¿æ¥å‡å°‘å¼€é”€
- **Keep-Alive**: ä¿æŒé•¿è¿æ¥
- **è¶…æ—¶æ§åˆ¶**: åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´

---

## 8. é”™è¯¯å¤„ç†

### 8.1 é”™è¯¯ä»£ç 

| é”™è¯¯ä»£ç  | è¯´æ˜ | å¤„ç†æ–¹å¼ |
|---------|------|---------|
| `INVALID_ARGUMENT` | æ— æ•ˆå‚æ•° | æ£€æŸ¥è¯·æ±‚æ•°æ® |
| `DEADLINE_EXCEEDED` | è¶…æ—¶ | é‡è¯• |
| `NOT_FOUND` | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥é…ç½® |
| `RESOURCE_EXHAUSTED` | èµ„æºè€—å°½ | é™æµã€é‡è¯• |
| `UNAVAILABLE` | æœåŠ¡ä¸å¯ç”¨ | é‡è¯•ã€é™çº§ |

### 8.2 é‡è¯•ç­–ç•¥

```rust
let retry_config = RetryConfig {
    max_attempts: 5,
    initial_backoff: Duration::from_millis(100),
    max_backoff: Duration::from_secs(30),
    backoff_multiplier: 2.0,
    jitter: true,
};
```

### 8.3 ç†”æ–­æœºåˆ¶

```rust
let circuit_breaker = CircuitBreaker::new()
    .with_failure_threshold(10)
    .with_success_threshold(2)
    .with_timeout(Duration::from_secs(60));
```

---

## 9. å®æ–½æŒ‡å—

### 9.1 å®¢æˆ·ç«¯å®ç°

#### 9.1.1 åŸºæœ¬å®ç°æ­¥éª¤

1. **é…ç½®å®¢æˆ·ç«¯**
```rust
let client = OtlpClient::builder()
    .with_endpoint("https://otlp.example.com:4317")
    .with_compression(Compression::Gzip)
    .with_timeout(Duration::from_secs(30))
    .build()?;
```

2. **å‘é€æ•°æ®**
```rust
// å‘é€è¿½è¸ªæ•°æ®
client.export_traces(traces).await?;

// å‘é€æŒ‡æ ‡æ•°æ®
client.export_metrics(metrics).await?;

// å‘é€æ—¥å¿—æ•°æ®
client.export_logs(logs).await?;
```

### 9.2 æœåŠ¡ç«¯å®ç°

#### 9.2.1 gRPC æœåŠ¡å®ç°

```rust
#[tonic::async_trait]
impl TraceService for MyTraceService {
    async fn export(
        &self,
        request: Request<ExportTraceServiceRequest>,
    ) -> Result<Response<ExportTraceServiceResponse>, Status> {
        // å¤„ç†è¿½è¸ªæ•°æ®
        let traces = request.into_inner();
        self.process_traces(traces).await?;
        
        Ok(Response::new(ExportTraceServiceResponse {
            partial_success: None,
        }))
    }
}
```

### 9.3 æµ‹è¯•éªŒè¯

#### 9.3.1 æµ‹è¯•æ¸…å•

- [ ] å•å…ƒæµ‹è¯•ï¼šå„ç»„ä»¶åŠŸèƒ½
- [ ] é›†æˆæµ‹è¯•ï¼šç«¯åˆ°ç«¯æµç¨‹
- [ ] æ€§èƒ½æµ‹è¯•ï¼šååé‡å’Œå»¶è¿Ÿ
- [ ] å‹åŠ›æµ‹è¯•ï¼šé«˜è´Ÿè½½åœºæ™¯
- [ ] å…¼å®¹æ€§æµ‹è¯•ï¼šå¤šç‰ˆæœ¬äº’æ“ä½œ

---

## 10. ç‰ˆæœ¬å…¼å®¹æ€§

### 10.1 åè®®ç‰ˆæœ¬

å½“å‰ç‰ˆæœ¬ï¼š**v1.3.0**

### 10.2 å‘åå…¼å®¹

- âœ… v1.x.x ç³»åˆ—ä¿è¯å‘åå…¼å®¹
- âœ… æ–°å­—æ®µæ·»åŠ ä¸ç ´åæ—§ç‰ˆæœ¬
- âœ… åºŸå¼ƒå­—æ®µä¿ç•™è‡³å°‘ä¸€ä¸ªä¸»ç‰ˆæœ¬

### 10.3 å‡çº§è·¯å¾„

```text
å‡çº§è·¯å¾„
v1.0.0 â†’ v1.1.0 â†’ v1.2.0 â†’ v1.3.0 (å½“å‰)
  â†“
v2.0.0 (æœªæ¥ï¼Œå¯èƒ½å­˜åœ¨ç ´åæ€§å˜æ›´)
```

---

## é™„å½• A: å®Œæ•´ç¤ºä¾‹

### å®Œæ•´çš„ OTLP å®¢æˆ·ç«¯ç¤ºä¾‹

```rust
use otlp::{OtlpClient, OtlpConfig, Compression};
use std::time::Duration;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // 1. é…ç½®å®¢æˆ·ç«¯
    let config = OtlpConfig::builder()
        .with_endpoint("https://otlp.example.com:4317")
        .with_compression(Compression::Gzip)
        .with_timeout(Duration::from_secs(30))
        .with_header("authorization", "Bearer YOUR_API_KEY")
        .with_tls_config(TlsConfig {
            enabled: true,
            cert_file: Some("/path/to/cert.pem"),
            ..Default::default()
        })
        .build()?;
    
    // 2. åˆ›å»ºå®¢æˆ·ç«¯
    let client = OtlpClient::new(config).await?;
    
    // 3. å‘é€è¿½è¸ªæ•°æ®
    let span = Span::builder("http_request")
        .with_kind(SpanKind::Server)
        .with_attribute("http.method", "GET")
        .with_attribute("http.url", "/api/users")
        .start();
    
    // æ‰§è¡Œæ“ä½œ...
    span.end();
    
    client.export_traces(vec![span]).await?;
    
    // 4. å‘é€æŒ‡æ ‡æ•°æ®
    let counter = Counter::new("http_requests_total")
        .with_description("Total HTTP requests");
    counter.add(1, &[("method", "GET"), ("status", "200")]);
    
    client.export_metrics(vec![counter.into()]).await?;
    
    // 5. å‘é€æ—¥å¿—æ•°æ®
    let log = LogRecord::builder()
        .with_severity(SeverityNumber::Info)
        .with_body("Request processed successfully")
        .with_attribute("request_id", "12345")
        .build();
    
    client.export_logs(vec![log]).await?;
    
    println!("âœ… All data exported successfully!");
    Ok(())
}
```

---

## é™„å½• B: å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [OpenTelemetry å®˜ç½‘](https://opentelemetry.io/)
- [OTLP è§„èŒƒ](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md)
- [Protocol Buffers å®šä¹‰](https://github.com/open-telemetry/opentelemetry-proto)

### ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](../01_å¿«é€Ÿå¼€å§‹/README.md)
- [æ ¸å¿ƒæ¦‚å¿µ](../02_æ ¸å¿ƒæ¦‚å¿µ/README.md)
- [æ¶æ„è®¾è®¡](../04_æ¶æ„è®¾è®¡/README.md)
- [API å‚è€ƒ](../API_REFERENCE.md)

### ç¤¾åŒºèµ„æº

- [OpenTelemetry GitHub](https://github.com/open-telemetry)
- [CNCF OpenTelemetry](https://www.cncf.io/projects/opentelemetry/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.1.0  
**æ•´åˆæ¥æº**: åˆå¹¶äº†å¤šä¸ªé‡å¤çš„è§„èŒƒæ–‡æ¡£  
**ç»´æŠ¤è€…**: OpenTelemetry 2025 æ ‡å‡†å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ27æ—¥  
**Rust ç‰ˆæœ¬**: 1.90.0

---

**æœ¬æ–‡æ¡£æ˜¯ OTLP åè®®çš„æƒå¨è§„èŒƒå‚è€ƒï¼Œæ‰€æœ‰å®ç°åº”éµå¾ªæ­¤è§„èŒƒã€‚** ğŸ“‹âœ…
