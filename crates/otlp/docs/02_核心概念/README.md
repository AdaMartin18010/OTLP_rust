# 核心概念

**版本**: 1.1.0  
**最后更新**: 2025年10月27日  
**状态**: 🟢 活跃维护

> **简介**: OTLP 协议的核心概念和理论基础，帮助用户深入理解 OTLP 的工作原理和设计思想。

---

## 📋 目录

- [核心概念](#核心概念)
  - [📋 目录](#-目录)
  - [1. 概述](#1-概述)
    - [1.1 目录说明](#11-目录说明)
    - [1.2 学习目标](#12-学习目标)
  - [2. 快速导航](#2-快速导航)
    - [2.1 文档列表](#21-文档列表)
    - [2.2 推荐阅读顺序](#22-推荐阅读顺序)
  - [3. 核心概念概览](#3-核心概念概览)
    - [3.1 OTLP 协议基础](#31-otlp-协议基础)
    - [3.2 数据模型](#32-数据模型)
    - [3.3 传输机制](#33-传输机制)
    - [3.4 语义约定](#34-语义约定)
  - [4. 技术架构](#4-技术架构)
    - [4.1 分层架构](#41-分层架构)
    - [4.2 核心组件](#42-核心组件)
  - [5. 学习路径](#5-学习路径)
    - [5.1 初学者路径](#51-初学者路径)
    - [5.2 进阶学习](#52-进阶学习)
  - [6. 相关资源](#6-相关资源)

---

## 1. 概述

### 1.1 目录说明

本目录包含 OTLP 协议的核心概念和理论基础，涵盖：

- **协议基础**: OTLP 协议的基本概念和设计原则
- **数据模型**: Traces、Metrics、Logs 的数据结构
- **传输机制**: gRPC、HTTP 等传输协议
- **语义约定**: 标准化的命名和属性规范

### 1.2 学习目标

完成本章节学习后，您将能够：

- ✅ 理解 OTLP 协议的核心概念
- ✅ 掌握三大数据类型（Traces、Metrics、Logs）
- ✅ 了解传输协议的选择和使用
- ✅ 应用语义约定的最佳实践

---

## 2. 快速导航

### 2.1 文档列表

| 文档 | 说明 | 难度 |
|------|------|------|
| [OTLP协议概述](OTLP协议概述.md) | 协议基础介绍 | ⭐ 入门 |
| [数据模型详解](数据模型详解.md) | 数据模型说明 | ⭐⭐ 中级 |
| [传输协议](传输协议.md) | 传输层协议详解 | ⭐⭐ 中级 |
| [语义约定](语义约定.md) | 语义约定标准 | ⭐⭐⭐ 高级 |

### 2.2 推荐阅读顺序

```text
学习路径
  ↓
1. OTLP协议概述 (30分钟)
  ↓
2. 数据模型详解 (1小时)
  ↓
3. 传输协议 (45分钟)
  ↓
4. 语义约定 (45分钟)
  ↓
[返回快速开始运行示例]
```

---

## 3. 核心概念概览

### 3.1 OTLP 协议基础

- **协议定义**: OpenTelemetry Protocol 的核心概念
- **设计原则**:
  - 标准化：统一的数据格式
  - 互操作性：跨语言、跨平台
  - 可扩展性：易于添加新特性
  - 性能优先：高吞吐量、低延迟
- **应用场景**: 分布式系统可观测性
- **技术优势**: 高性能、类型安全、跨语言支持

### 3.2 数据模型

#### 3.2.1 追踪数据（Traces）

- **Span 模型**: 分布式追踪的基本单元
- **Trace ID**: 全局唯一的追踪标识
- **Span 类型**: Internal、Server、Client、Producer、Consumer
- **时间信息**: 开始时间、结束时间、持续时间

#### 3.2.2 指标数据（Metrics）

- **Gauge**: 瞬时值（如：CPU 使用率）
- **Counter**: 累加计数器（如：请求总数）
- **Histogram**: 直方图（如：请求延迟分布）
- **Summary**: 摘要（如：延迟百分位数）

#### 3.2.3 日志数据（Logs）

- **LogRecord**: 结构化日志记录
- **严重级别**: Trace、Debug、Info、Warn、Error、Fatal
- **关联追踪**: 通过 Trace ID 和 Span ID 关联
- **结构化属性**: 键值对属性系统

### 3.3 传输机制

#### 3.3.1 支持的传输协议

| 协议 | 特性 | 推荐场景 |
|------|------|---------|
| **gRPC** | 高性能、双向流、多路复用 | 生产环境首选 |
| **HTTP/1.1** | 广泛支持、简单易用 | 兼容性要求高 |
| **HTTP/2** | 多路复用、服务器推送 | 现代化部署 |

#### 3.3.2 序列化

- **Protocol Buffers**: 二进制序列化格式
- **高效性**: 比 JSON 小 3-10 倍
- **跨语言**: 支持所有主流编程语言
- **版本兼容**: 向后兼容保证

#### 3.3.3 压缩

- **gzip**: 通用压缩算法（推荐）
- **snappy**: 快速压缩（低延迟场景）
- **zstd**: 高压缩率（高吞吐量场景）

### 3.4 语义约定

#### 3.4.1 标准化属性

```yaml
# 服务属性
service.name: "my-service"
service.version: "1.0.0"
service.namespace: "production"

# HTTP 属性
http.method: "GET"
http.url: "/api/users"
http.status_code: 200

# 数据库属性
db.system: "postgresql"
db.name: "users_db"
db.statement: "SELECT * FROM users"
```

#### 3.4.2 资源模型

- **服务信息**: 名称、版本、实例 ID
- **部署环境**: 环境、云提供商、区域
- **主机信息**: 主机名、架构、操作系统
- **进程信息**: PID、命令行、运行时

#### 3.4.3 上下文传播

- **W3C Trace Context**: 标准的上下文传播格式
- **Baggage**: 跨服务传递的键值对
- **Trace State**: 供应商特定的追踪状态

#### 3.4.4 采样策略

- **总是采样**: 所有请求都采样
- **从不采样**: 不采样任何请求
- **概率采样**: 按比例采样（如：10%）
- **基于规则**: 根据属性决定（如：错误请求必须采样）

---

## 4. 技术架构

### 4.1 分层架构

```text
┌─────────────────────────────────────────────────────────┐
│                      应用层                               │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐            │
│  │  Traces   │  │  Metrics  │  │   Logs    │            │
│  └───────────┘  └───────────┘  └───────────┘            │
│  ┌───────────────────────────────────────┐              │
│  │        Resource & Attributes          │              │
│  └───────────────────────────────────────┘              │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                      协议层                               │
│  ┌───────────────────────────────────────┐              │
│  │      OTLP 协议定义 (Protobuf)         │              │
│  ├───────────────────────────────────────┤              │
│  │      数据序列化与反序列化              │              │
│  └───────────────────────────────────────┘              │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                      传输层                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐              │
│  │  gRPC    │  │ HTTP/1.1 │  │ HTTP/2   │              │
│  └──────────┘  └──────────┘  └──────────┘              │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                      网络层                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐              │
│  │  TCP/IP  │  │ TLS/SSL  │  │  其他    │              │
│  └──────────┘  └──────────┘  └──────────┘              │
└─────────────────────────────────────────────────────────┘
```

### 4.2 核心组件

1. **数据收集器**: 收集应用程序的遥测数据
2. **处理器**: 处理和转换数据（过滤、批处理、采样）
3. **导出器**: 将数据导出到后端（OTLP Collector、Jaeger、Prometheus）
4. **传输层**: 网络传输实现（gRPC、HTTP）

---

## 5. 学习路径

### 5.1 初学者路径

**目标**: 理解基本概念，能够使用 OTLP

**学习步骤**:

1. **第1天**: [OTLP协议概述](OTLP协议概述.md)
   - 了解 OTLP 是什么
   - 理解为什么需要 OTLP
   - 学习基本概念

2. **第2-3天**: [数据模型详解](数据模型详解.md)
   - 学习 Traces、Metrics、Logs 数据模型
   - 理解资源和属性系统
   - 掌握数据结构

3. **第4天**: [传输协议](传输协议.md)
   - 了解 gRPC 和 HTTP 传输
   - 学习序列化和压缩
   - 理解传输配置

4. **第5天**: [语义约定](语义约定.md)
   - 掌握标准化属性
   - 学习命名规范
   - 应用最佳实践

**下一步**: 回到 [快速开始](../01_快速开始/README.md) 运行示例，加深理解

### 5.2 进阶学习

**目标**: 深入理解实现细节，能够进行高级配置

**推荐路径**:

1. 深入理解数据模型设计
   - Span 的生命周期
   - Metric 的聚合方式
   - Log 的结构化设计

2. 学习传输协议实现
   - gRPC 服务定义
   - HTTP 端点设计
   - 错误处理机制

3. 掌握语义约定标准
   - 资源属性规范
   - Span 属性规范
   - Metric 命名规范

4. 实践应用场景
   - 分布式追踪
   - 性能监控
   - 日志聚合

---

## 6. 相关资源

### 6.1 项目文档

- [快速开始](../01_快速开始/README.md) - 入门指南
- [标准规范](../03_标准规范/README.md) - 规范文档
- [架构设计](../04_架构设计/README.md) - 架构设计
- [开发指南](../05_开发指南/README.md) - 开发实现
- [API 参考](../API_REFERENCE.md) - API 文档

### 6.2 外部资源

- [OpenTelemetry 官网](https://opentelemetry.io/)
- [OTLP 规范](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md)
- [Protocol Buffers](https://developers.google.com/protocol-buffers)

### 6.3 社区资源

- [OpenTelemetry GitHub](https://github.com/open-telemetry)
- [CNCF OpenTelemetry](https://www.cncf.io/projects/opentelemetry/)

---

**文档版本**: 1.1.0  
**维护者**: OTLP 核心团队  
**最后更新**: 2025年10月27日

---

**开始学习**: 从 [OTLP协议概述](OTLP协议概述.md) 开始您的学习之旅！ 🚀
