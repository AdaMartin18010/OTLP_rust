# ğŸ“˜ OpenTelemetryå®‰å…¨é…ç½®é€ŸæŸ¥æ‰‹å†Œ

> **æœ€åæ›´æ–°**: 2025å¹´10æœˆ9æ—¥  
> **ç”¨é€”**: å¿«é€Ÿé…ç½®OpenTelemetryå®‰å…¨é˜²æŠ¤

---

## ğŸ¯ é€ŸæŸ¥ç›®å½•

- [ğŸ“˜ OpenTelemetryå®‰å…¨é…ç½®é€ŸæŸ¥æ‰‹å†Œ](#-opentelemetryå®‰å…¨é…ç½®é€ŸæŸ¥æ‰‹å†Œ)
  - [ğŸ¯ é€ŸæŸ¥ç›®å½•](#-é€ŸæŸ¥ç›®å½•)
  - [ğŸš¨ å®‰å…¨å¨èƒ](#-å®‰å…¨å¨èƒ)
    - [OTLPå¸¸è§å®‰å…¨é£é™©](#otlpå¸¸è§å®‰å…¨é£é™©)
  - [ğŸ”’ ä¼ è¾“åŠ å¯†](#-ä¼ è¾“åŠ å¯†)
    - [1. TLSé…ç½® (å¿…é¡»!)](#1-tlsé…ç½®-å¿…é¡»)
      - [CollectoræœåŠ¡ç«¯é…ç½®](#collectoræœåŠ¡ç«¯é…ç½®)
      - [SDKå®¢æˆ·ç«¯é…ç½®](#sdkå®¢æˆ·ç«¯é…ç½®)
    - [2. è¯ä¹¦ç®¡ç†](#2-è¯ä¹¦ç®¡ç†)
      - [ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ (å¼€å‘/æµ‹è¯•ç¯å¢ƒ)](#ç”Ÿæˆè‡ªç­¾åè¯ä¹¦-å¼€å‘æµ‹è¯•ç¯å¢ƒ)
      - [è¯ä¹¦è½®æ¢ç­–ç•¥](#è¯ä¹¦è½®æ¢ç­–ç•¥)
  - [ğŸ”‘ è®¤è¯æˆæƒ](#-è®¤è¯æˆæƒ)
    - [1. Bearer Tokenè®¤è¯](#1-bearer-tokenè®¤è¯)
      - [Collectoré…ç½®](#collectoré…ç½®)
      - [SDKé…ç½®](#sdké…ç½®)
    - [2. API Keyè®¤è¯](#2-api-keyè®¤è¯)
    - [3. OAuth 2.0è®¤è¯](#3-oauth-20è®¤è¯)
    - [4. mTLS (åŒå‘TLS,æœ€å®‰å…¨)](#4-mtls-åŒå‘tlsæœ€å®‰å…¨)
  - [ğŸ›¡ï¸ æ•°æ®è„±æ•](#ï¸-æ•°æ®è„±æ•)
    - [1. åˆ é™¤æ•æ„Ÿå­—æ®µ](#1-åˆ é™¤æ•æ„Ÿå­—æ®µ)
    - [2. å“ˆå¸Œè„±æ•](#2-å“ˆå¸Œè„±æ•)
    - [3. æ—¥å¿—è„±æ•](#3-æ—¥å¿—è„±æ•)
    - [4. SDKå±‚è„±æ• (æ¨è)](#4-sdkå±‚è„±æ•-æ¨è)
  - [ğŸŒ ç½‘ç»œéš”ç¦»](#-ç½‘ç»œéš”ç¦»)
    - [1. VPCéƒ¨ç½² (æ¨è)](#1-vpcéƒ¨ç½²-æ¨è)
    - [2. Kubernetes NetworkPolicy](#2-kubernetes-networkpolicy)
    - [3. é˜²ç«å¢™è§„åˆ™](#3-é˜²ç«å¢™è§„åˆ™)
  - [ğŸšª è®¿é—®æ§åˆ¶](#-è®¿é—®æ§åˆ¶)
    - [1. RBAC (Kubernetes)](#1-rbac-kubernetes)
    - [2. Pod Security Policy](#2-pod-security-policy)
  - [ğŸ“ å®¡è®¡æ—¥å¿—](#-å®¡è®¡æ—¥å¿—)
    - [1. å¯ç”¨Collectorå®¡è®¡æ—¥å¿—](#1-å¯ç”¨collectorå®¡è®¡æ—¥å¿—)
    - [2. è®°å½•è®¤è¯äº‹ä»¶](#2-è®°å½•è®¤è¯äº‹ä»¶)
  - [ğŸ” å¯†é’¥ç®¡ç†](#-å¯†é’¥ç®¡ç†)
    - [1. ç¯å¢ƒå˜é‡ (åŸºç¡€)](#1-ç¯å¢ƒå˜é‡-åŸºç¡€)
    - [2. Kubernetes Secrets](#2-kubernetes-secrets)
    - [3. Vaulté›†æˆ (ä¼ä¸šçº§)](#3-vaulté›†æˆ-ä¼ä¸šçº§)
  - [âœ… å®‰å…¨æ¸…å•](#-å®‰å…¨æ¸…å•)
    - [ç”Ÿäº§ç¯å¢ƒå®‰å…¨åŸºçº¿](#ç”Ÿäº§ç¯å¢ƒå®‰å…¨åŸºçº¿)
  - [ğŸ¯ å®‰å…¨ç­‰çº§](#-å®‰å…¨ç­‰çº§)
    - [Level 1: åŸºç¡€å®‰å…¨ (å¼€å‘ç¯å¢ƒ)](#level-1-åŸºç¡€å®‰å…¨-å¼€å‘ç¯å¢ƒ)
    - [Level 2: å¢å¼ºå®‰å…¨ (æµ‹è¯•ç¯å¢ƒ)](#level-2-å¢å¼ºå®‰å…¨-æµ‹è¯•ç¯å¢ƒ)
    - [Level 3: é«˜å®‰å…¨ (ç”Ÿäº§ç¯å¢ƒ)](#level-3-é«˜å®‰å…¨-ç”Ÿäº§ç¯å¢ƒ)
  - [ğŸ“š å‚è€ƒèµ„æº](#-å‚è€ƒèµ„æº)
  - [ğŸ¯ æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)

---

## ğŸš¨ å®‰å…¨å¨èƒ

### OTLPå¸¸è§å®‰å…¨é£é™©

| å¨èƒ | å½±å“ | ä¸¥é‡ç¨‹åº¦ | ç¼“è§£æªæ–½ |
|-----|------|---------|---------|
| **ä¸­é—´äººæ”»å‡» (MITM)** | æ•°æ®çªƒå–/ç¯¡æ”¹ | ğŸ”´ é«˜ | TLSåŠ å¯† |
| **æœªæˆæƒè®¿é—®** | æ•°æ®æ³„éœ² | ğŸ”´ é«˜ | è®¤è¯/æˆæƒ |
| **æ•æ„Ÿæ•°æ®æ³„éœ²** | éšç§æ³„éœ² | ğŸ”´ é«˜ | æ•°æ®è„±æ• |
| **DDoSæ”»å‡»** | æœåŠ¡ä¸­æ–­ | ğŸŸ¡ ä¸­ | é€Ÿç‡é™åˆ¶ |
| **æ•°æ®æ³¨å…¥** | æ±¡æŸ“æ•°æ® | ğŸŸ¡ ä¸­ | è¾“å…¥éªŒè¯ |
| **é…ç½®æ³„éœ²** | å‡­è¯æ³„éœ² | ğŸ”´ é«˜ | å¯†é’¥ç®¡ç† |

---

## ğŸ”’ ä¼ è¾“åŠ å¯†

### 1. TLSé…ç½® (å¿…é¡»!)

#### CollectoræœåŠ¡ç«¯é…ç½®

```yaml
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
        tls:
          cert_file: /etc/ssl/certs/server.crt
          key_file: /etc/ssl/private/server.key
          # å¯é€‰: å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯ (mTLS)
          client_ca_file: /etc/ssl/certs/ca.crt
          # è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦
          require_client_auth: true
      
      http:
        endpoint: 0.0.0.0:4318
        tls:
          cert_file: /etc/ssl/certs/server.crt
          key_file: /etc/ssl/private/server.key
```

#### SDKå®¢æˆ·ç«¯é…ç½®

```go
// Go SDK - TLSé…ç½®
import (
    "crypto/tls"
    "crypto/x509"
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "google.golang.org/grpc/credentials"
)

func initSecureTracer() (*trace.TracerProvider, error) {
    // åŠ è½½CAè¯ä¹¦
    caCert, _ := os.ReadFile("/etc/ssl/certs/ca.crt")
    caCertPool := x509.NewCertPool()
    caCertPool.AppendCertsFromPEM(caCert)
    
    // åŠ è½½å®¢æˆ·ç«¯è¯ä¹¦ (mTLS)
    clientCert, _ := tls.LoadX509KeyPair(
        "/etc/ssl/certs/client.crt",
        "/etc/ssl/private/client.key",
    )
    
    // TLSé…ç½®
    tlsConfig := &tls.Config{
        RootCAs:      caCertPool,
        Certificates: []tls.Certificate{clientCert},
        MinVersion:   tls.VersionTLS13,  // å¼ºåˆ¶TLS 1.3
    }
    
    exporter, err := otlptracegrpc.New(
        context.Background(),
        otlptracegrpc.WithEndpoint("collector.example.com:4317"),
        otlptracegrpc.WithTLSCredentials(credentials.NewTLS(tlsConfig)),
    )
    
    tp := trace.NewTracerProvider(
        trace.WithBatcher(exporter),
    )
    return tp, nil
}
```

```python
# Python SDK - TLSé…ç½®
from opentelemetry.exporter.otlp.proto.grpc.trace_exporter import OTLPSpanExporter

exporter = OTLPSpanExporter(
    endpoint="collector.example.com:4317",
    credentials=grpc.ssl_channel_credentials(
        root_certificates=open('/etc/ssl/certs/ca.crt', 'rb').read(),
        private_key=open('/etc/ssl/private/client.key', 'rb').read(),
        certificate_chain=open('/etc/ssl/certs/client.crt', 'rb').read(),
    ),
)
```

---

### 2. è¯ä¹¦ç®¡ç†

#### ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ (å¼€å‘/æµ‹è¯•ç¯å¢ƒ)

```bash
# 1. ç”ŸæˆCAå¯†é’¥å’Œè¯ä¹¦
openssl req -x509 -newkey rsa:4096 -keyout ca.key -out ca.crt \
  -days 365 -nodes -subj "/CN=My CA"

# 2. ç”ŸæˆæœåŠ¡ç«¯å¯†é’¥
openssl genrsa -out server.key 4096

# 3. ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ç­¾åè¯·æ±‚ (CSR)
openssl req -new -key server.key -out server.csr \
  -subj "/CN=collector.example.com"

# 4. ä½¿ç”¨CAç­¾åæœåŠ¡ç«¯è¯ä¹¦
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key \
  -CAcreateserial -out server.crt -days 365

# 5. ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦ (mTLS)
openssl genrsa -out client.key 4096
openssl req -new -key client.key -out client.csr \
  -subj "/CN=client"
openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key \
  -CAcreateserial -out client.crt -days 365
```

#### è¯ä¹¦è½®æ¢ç­–ç•¥

```yaml
# ä½¿ç”¨cert-managerè‡ªåŠ¨è½®æ¢ (Kubernetes)
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: otel-collector-cert
spec:
  secretName: otel-collector-tls
  duration: 2160h  # 90å¤©
  renewBefore: 360h  # æå‰15å¤©ç»­æœŸ
  issuerRef:
    name: ca-issuer
    kind: ClusterIssuer
  dnsNames:
    - collector.example.com
    - collector.otel-system.svc.cluster.local
```

---

## ğŸ”‘ è®¤è¯æˆæƒ

### 1. Bearer Tokenè®¤è¯

#### Collectoré…ç½®

```yaml
receivers:
  otlp:
    protocols:
      http:
        endpoint: 0.0.0.0:4318

extensions:
  bearertokenauth:
    scheme: "Bearer"
    token: "${OTEL_API_TOKEN}"  # ä»ç¯å¢ƒå˜é‡è¯»å–

service:
  extensions: [bearertokenauth]
  pipelines:
    traces:
      receivers: [otlp]
```

#### SDKé…ç½®

```go
// Go SDK
exporter, _ := otlptracegrpc.New(
    ctx,
    otlptracegrpc.WithEndpoint("collector:4317"),
    otlptracegrpc.WithHeaders(map[string]string{
        "Authorization": "Bearer " + os.Getenv("OTEL_API_TOKEN"),
    }),
)
```

```python
# Python SDK
exporter = OTLPSpanExporter(
    endpoint="collector:4317",
    headers={
        "Authorization": f"Bearer {os.getenv('OTEL_API_TOKEN')}"
    },
)
```

---

### 2. API Keyè®¤è¯

```yaml
# Collectoré…ç½®
extensions:
  headers_setter:
    headers:
      - key: X-API-Key
        from_context: api_key

processors:
  attributes:
    actions:
      - key: api.key
        action: delete  # å¤„ç†ååˆ é™¤æ•æ„Ÿå­—æ®µ

receivers:
  otlp:
    protocols:
      http:
        endpoint: 0.0.0.0:4318

service:
  extensions: [headers_setter]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [attributes]
```

---

### 3. OAuth 2.0è®¤è¯

```yaml
# Collectorå¯¼å‡ºåˆ°éœ€è¦OAuthçš„åç«¯
exporters:
  otlphttp:
    endpoint: https://api.observability-platform.com/v1/traces
    auth:
      authenticator: oauth2client

extensions:
  oauth2client:
    client_id: ${OAUTH_CLIENT_ID}
    client_secret: ${OAUTH_CLIENT_SECRET}
    token_url: https://auth.example.com/oauth/token
    scopes:
      - telemetry.write
    timeout: 30s

service:
  extensions: [oauth2client]
  pipelines:
    traces:
      exporters: [otlphttp]
```

---

### 4. mTLS (åŒå‘TLS,æœ€å®‰å…¨)

```yaml
# Collectoré…ç½®
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
        tls:
          cert_file: /etc/ssl/certs/server.crt
          key_file: /etc/ssl/private/server.key
          client_ca_file: /etc/ssl/certs/ca.crt
          # å¼ºåˆ¶è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦
          require_client_auth: true
```

**ä¼˜åŠ¿**:

- âœ… æœ€é«˜å®‰å…¨çº§åˆ«
- âœ… åŒå‘èº«ä»½éªŒè¯
- âœ… é˜²æ­¢æœªæˆæƒè®¿é—®
- âš ï¸ é…ç½®å¤æ‚åº¦é«˜

---

## ğŸ›¡ï¸ æ•°æ®è„±æ•

### 1. åˆ é™¤æ•æ„Ÿå­—æ®µ

```yaml
processors:
  attributes:
    actions:
      # åˆ é™¤æ•æ„ŸHTTPå¤´
      - key: http.request.header.authorization
        action: delete
      - key: http.request.header.cookie
        action: delete
      - key: http.request.header.x-api-key
        action: delete
      
      # åˆ é™¤æ•æ„ŸæŸ¥è¯¢å‚æ•°
      - key: http.url
        pattern: '(token|key|password|secret)=[^&]*'
        action: extract
        extract_pattern: '(token|key|password|secret)=REDACTED'
      
      # åˆ é™¤PIIæ•°æ®
      - key: user.email
        action: delete
      - key: user.phone
        action: delete
      - key: user.ssn
        action: delete
```

---

### 2. å“ˆå¸Œè„±æ•

```yaml
processors:
  transform:
    trace_statements:
      - context: span
        statements:
          # å¯¹æ•æ„Ÿå­—æ®µè¿›è¡Œå“ˆå¸Œ
          - set(attributes["user.id"], SHA256(attributes["user.id"]))
          - set(attributes["client.ip"], SHA256(attributes["client.ip"]))
```

---

### 3. æ—¥å¿—è„±æ•

```yaml
processors:
  logstransform:
    operators:
      # ä½¿ç”¨æ­£åˆ™æ›¿æ¢æ•æ„Ÿä¿¡æ¯
      - type: regex_parser
        regex: '(?P<log>.*)(password|token|secret)=(?P<value>\S+)'
        output: |
          {{ .log }}password=***REDACTED***
```

---

### 4. SDKå±‚è„±æ• (æ¨è)

```go
// Go SDK - è‡ªå®šä¹‰Spanå¤„ç†å™¨
type RedactingProcessor struct {
    next trace.SpanProcessor
}

func (p *RedactingProcessor) OnStart(parent context.Context, s sdktrace.ReadWriteSpan) {
    // åœ¨Spanåˆ›å»ºæ—¶å°±è„±æ•
    attrs := s.Attributes()
    for _, attr := range attrs {
        if strings.Contains(attr.Key, "password") ||
           strings.Contains(attr.Key, "token") {
            s.SetAttributes(attribute.String(attr.Key, "***REDACTED***"))
        }
    }
    p.next.OnStart(parent, s)
}

// ä½¿ç”¨
tp := trace.NewTracerProvider(
    trace.WithSpanProcessor(&RedactingProcessor{
        next: trace.NewBatchSpanProcessor(exporter),
    }),
)
```

---

## ğŸŒ ç½‘ç»œéš”ç¦»

### 1. VPCéƒ¨ç½² (æ¨è)

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Public Internet            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ âŒ ä¸å¯ç›´æ¥è®¿é—®
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    Load Balancer    â”‚ (å¯é€‰, HTTPS)
         â”‚   (å…¬ç½‘æš´éœ²ç‚¹)       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Private VPC                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     App     â”‚â”€â”€â”€â”€â”€>â”‚  Collector  â”‚    â”‚
â”‚  â”‚  (ç§æœ‰IP)   â”‚      â”‚  (ç§æœ‰IP)   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚            â”‚
â”‚                               â–¼            â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                     â”‚   Backend   â”‚       â”‚
â”‚                     â”‚  (ç§æœ‰IP)   â”‚       â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Kubernetes NetworkPolicy

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: otel-collector-policy
  namespace: otel-system
spec:
  podSelector:
    matchLabels:
      app: otel-collector
  policyTypes:
    - Ingress
    - Egress
  
  ingress:
    # ä»…å…è®¸åŒå‘½åç©ºé—´çš„åº”ç”¨è®¿é—®
    - from:
      - namespaceSelector:
          matchLabels:
            name: production
      ports:
      - protocol: TCP
        port: 4317
      - protocol: TCP
        port: 4318
  
  egress:
    # ä»…å…è®¸è®¿é—®åç«¯
    - to:
      - podSelector:
          matchLabels:
            app: observability-backend
      ports:
      - protocol: TCP
        port: 4317
```

---

### 3. é˜²ç«å¢™è§„åˆ™

```bash
# iptablesè§„åˆ™ç¤ºä¾‹
# ä»…å…è®¸å†…ç½‘è®¿é—®Collector
iptables -A INPUT -p tcp --dport 4317 -s 10.0.0.0/8 -j ACCEPT
iptables -A INPUT -p tcp --dport 4317 -j DROP

iptables -A INPUT -p tcp --dport 4318 -s 10.0.0.0/8 -j ACCEPT
iptables -A INPUT -p tcp --dport 4318 -j DROP
```

---

## ğŸšª è®¿é—®æ§åˆ¶

### 1. RBAC (Kubernetes)

```yaml
# ServiceAccount
apiVersion: v1
kind: ServiceAccount
metadata:
  name: otel-collector
  namespace: otel-system

---
# Role - ä»…è¯»å–ConfigMapå’ŒSecret
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: otel-collector-role
  namespace: otel-system
rules:
  - apiGroups: [""]
    resources: ["configmaps", "secrets"]
    verbs: ["get", "list", "watch"]

---
# RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: otel-collector-rolebinding
  namespace: otel-system
subjects:
  - kind: ServiceAccount
    name: otel-collector
roleRef:
  kind: Role
  name: otel-collector-role
  apiGroup: rbac.authorization.k8s.io
```

---

### 2. Pod Security Policy

```yaml
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: otel-collector-psp
spec:
  privileged: false
  allowPrivilegeEscalation: false
  requiredDropCapabilities:
    - ALL
  volumes:
    - 'configMap'
    - 'secret'
    - 'emptyDir'
  runAsUser:
    rule: 'MustRunAsNonRoot'
  seLinux:
    rule: 'RunAsAny'
  fsGroup:
    rule: 'RunAsAny'
  readOnlyRootFilesystem: true
```

---

## ğŸ“ å®¡è®¡æ—¥å¿—

### 1. å¯ç”¨Collectorå®¡è®¡æ—¥å¿—

```yaml
service:
  telemetry:
    logs:
      level: info
      encoding: json
      output_paths:
        - stdout
        - /var/log/otel/audit.log
      error_output_paths:
        - stderr
    # è®°å½•è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—
    metrics:
      level: detailed
      address: 0.0.0.0:8888
```

---

### 2. è®°å½•è®¤è¯äº‹ä»¶

```yaml
processors:
  attributes:
    actions:
      # è®°å½•è¯·æ±‚æ¥æº
      - key: audit.client.ip
        from_context: X-Forwarded-For
        action: upsert
      - key: audit.timestamp
        value: ${timestamp}
        action: insert
      - key: audit.api_key_hash
        value: ${hash(api_key)}
        action: insert
```

---

## ğŸ” å¯†é’¥ç®¡ç†

### 1. ç¯å¢ƒå˜é‡ (åŸºç¡€)

```yaml
# âŒ ä¸è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ç¡¬ç¼–ç 
exporters:
  otlp:
    headers:
      Authorization: "Bearer secret-token-12345"  # âŒ

# âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡
exporters:
  otlp:
    headers:
      Authorization: "Bearer ${OTEL_API_TOKEN}"  # âœ…
```

---

### 2. Kubernetes Secrets

```yaml
# Secret
apiVersion: v1
kind: Secret
metadata:
  name: otel-secrets
  namespace: otel-system
type: Opaque
data:
  api-token: <base64-encoded-token>
  tls-cert: <base64-encoded-cert>
  tls-key: <base64-encoded-key>

---
# Deploymentä½¿ç”¨Secret
apiVersion: apps/v1
kind: Deployment
metadata:
  name: otel-collector
spec:
  template:
    spec:
      containers:
      - name: otel-collector
        env:
          - name: OTEL_API_TOKEN
            valueFrom:
              secretKeyRef:
                name: otel-secrets
                key: api-token
        volumeMounts:
          - name: tls-certs
            mountPath: /etc/ssl/certs
            readOnly: true
      volumes:
        - name: tls-certs
          secret:
            secretName: otel-secrets
```

---

### 3. Vaulté›†æˆ (ä¼ä¸šçº§)

```yaml
extensions:
  vault:
    endpoint: https://vault.example.com
    path: secret/otel
    auth:
      kubernetes:
        role: otel-collector
        token_path: /var/run/secrets/kubernetes.io/serviceaccount/token

exporters:
  otlp:
    headers:
      Authorization: "Bearer ${vault:api_token}"
```

---

## âœ… å®‰å…¨æ¸…å•

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨åŸºçº¿

```text
âœ… ä¼ è¾“å®‰å…¨
  â–¡ å¯ç”¨TLS 1.3 (æ‰€æœ‰è¿æ¥)
  â–¡ ä½¿ç”¨æœ‰æ•ˆè¯ä¹¦ (Let's Encryptæˆ–ä¼ä¸šCA)
  â–¡ å¯ç”¨mTLS (é«˜å®‰å…¨åœºæ™¯)
  â–¡ ç¦ç”¨insecureæ¨¡å¼

âœ… è®¤è¯æˆæƒ
  â–¡ å¯ç”¨API Keyæˆ–Bearer Tokenè®¤è¯
  â–¡ ä½¿ç”¨æœ€å°æƒé™åŸåˆ™ (RBAC)
  â–¡ å®šæœŸè½®æ¢å¯†é’¥ (30-90å¤©)
  â–¡ è®°å½•æ‰€æœ‰è®¤è¯äº‹ä»¶

âœ… æ•°æ®ä¿æŠ¤
  â–¡ è„±æ•æ•æ„ŸHTTPå¤´ (Authorization, Cookie)
  â–¡ è„±æ•PIIæ•°æ® (email, phone, SSN)
  â–¡ åˆ é™¤æˆ–å“ˆå¸Œé«˜åŸºæ•°æ ‡è¯†ç¬¦
  â–¡ å®¡æŸ¥æ‰€æœ‰å¯¼å‡ºçš„æ•°æ®

âœ… ç½‘ç»œå®‰å…¨
  â–¡ éƒ¨ç½²åœ¨ç§æœ‰ç½‘ç»œ (VPC)
  â–¡ é…ç½®é˜²ç«å¢™è§„åˆ™
  â–¡ å¯ç”¨NetworkPolicy (K8s)
  â–¡ ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨åˆ†å‘æµé‡

âœ… å¯†é’¥ç®¡ç†
  â–¡ ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
  â–¡ ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–Secrets
  â–¡ é›†æˆå¯†é’¥ç®¡ç†ç³»ç»Ÿ (Vault)
  â–¡ åŠ å¯†å­˜å‚¨å¯†é’¥

âœ… å®¡è®¡ä¸ç›‘æ§
  â–¡ å¯ç”¨å®¡è®¡æ—¥å¿—
  â–¡ ç›‘æ§å¼‚å¸¸è®¿é—®æ¨¡å¼
  â–¡ è®¾ç½®å®‰å…¨å‘Šè­¦
  â–¡ å®šæœŸå®‰å…¨å®¡è®¡

âœ… è¿ç»´å®‰å…¨
  â–¡ ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ
  â–¡ åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ
  â–¡ é™åˆ¶å®¹å™¨æƒé™ (capabilities)
  â–¡ å®šæœŸæ›´æ–°Collectorç‰ˆæœ¬
```

---

## ğŸ¯ å®‰å…¨ç­‰çº§

### Level 1: åŸºç¡€å®‰å…¨ (å¼€å‘ç¯å¢ƒ)

```yaml
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

# âœ… åŸºç¡€é…ç½®,æ— å®‰å…¨é˜²æŠ¤
```

---

### Level 2: å¢å¼ºå®‰å…¨ (æµ‹è¯•ç¯å¢ƒ)

```yaml
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
        tls:
          cert_file: /etc/ssl/certs/server.crt
          key_file: /etc/ssl/private/server.key

extensions:
  bearertokenauth:
    token: "${OTEL_API_TOKEN}"

# âœ… TLSåŠ å¯† + API Tokenè®¤è¯
```

---

### Level 3: é«˜å®‰å…¨ (ç”Ÿäº§ç¯å¢ƒ)

```yaml
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
        tls:
          cert_file: /etc/ssl/certs/server.crt
          key_file: /etc/ssl/private/server.key
          client_ca_file: /etc/ssl/certs/ca.crt
          require_client_auth: true  # mTLS

processors:
  attributes:
    actions:
      - key: http.request.header.authorization
        action: delete
      - key: user.email
        action: delete

extensions:
  oauth2client:
    client_id: ${OAUTH_CLIENT_ID}
    client_secret: ${OAUTH_CLIENT_SECRET}
    token_url: https://auth.example.com/oauth/token

# âœ… mTLS + OAuth 2.0 + æ•°æ®è„±æ•
```

---

## ğŸ“š å‚è€ƒèµ„æº

| èµ„æº | é“¾æ¥ |
|------|------|
| **å®‰å…¨æœ€ä½³å®è·µ** | <https://opentelemetry.io/docs/specs/otel/security/> |
| **TLSé…ç½®** | <https://opentelemetry.io/docs/collector/configuration/#tls-configuration> |
| **è®¤è¯æ‰©å±•** | <https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension> |
| **æ•°æ®è„±æ•** | <https://opentelemetry.io/docs/specs/otel/common/attribute-naming/> |

---

## ğŸ¯ æœ€ä½³å®è·µ

```text
âœ… ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¯ç”¨TLS
âœ… ä½¿ç”¨mTLSå®ç°æœ€é«˜å®‰å…¨çº§åˆ«
âœ… åœ¨SDKå±‚å°±è¿›è¡Œæ•°æ®è„±æ•
âœ… å®šæœŸè½®æ¢è¯ä¹¦å’Œå¯†é’¥
âœ… ä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿ (Vault)
âœ… æœ€å°æƒé™åŸåˆ™ (RBAC)
âœ… å¯ç”¨å®¡è®¡æ—¥å¿—
âœ… ç›‘æ§å¼‚å¸¸è®¿é—®æ¨¡å¼
âœ… å®šæœŸå®‰å…¨å®¡è®¡
âœ… åŠæ—¶æ›´æ–°åˆ°æœ€æ–°ç¨³å®šç‰ˆ
```

---

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ9æ—¥  
**ä¸Šä¸€ç¯‡**: [æ€§èƒ½ä¼˜åŒ–é€ŸæŸ¥æ‰‹å†Œ](./05_æ€§èƒ½ä¼˜åŒ–é€ŸæŸ¥æ‰‹å†Œ.md)  
**ç³»åˆ—å®Œæˆ**: è¿”å›[OTLPåè®®é€ŸæŸ¥æ‰‹å†Œ](./01_OTLPåè®®é€ŸæŸ¥æ‰‹å†Œ.md)
