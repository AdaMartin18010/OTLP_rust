# âš¡ é…ç½®ç”Ÿæˆå™¨ - 3åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

## ğŸš€ è¶…å¿«é€Ÿå¼€å§‹ (30ç§’)

```bash
# 1. æ‰“å¼€å·¥å…· (åŒå‡»æˆ–å‘½ä»¤è¡Œ)
open index.html    # macOS
start index.html   # Windows
xdg-open index.html # Linux

# 2. é€‰æ‹©é…ç½® â†’ ç‚¹å‡»"ç”Ÿæˆé…ç½®" â†’ å¤åˆ¶ä½¿ç”¨
# å°±è¿™ä¹ˆç®€å•ï¼
```

---

## ğŸ“ å…¸å‹åœºæ™¯

### åœºæ™¯1: æ–°æ‰‹å…¥é—¨ (ç¬¬ä¸€æ¬¡ä½¿ç”¨)

**ç›®æ ‡**: ç”Ÿæˆä¸€ä¸ªç®€å•çš„å¼€å‘ç¯å¢ƒé…ç½®

**æ­¥éª¤** (å…±3æ­¥):

1. **éƒ¨ç½²æ¨¡å¼**: é€‰æ‹© `Gatewayæ¨¡å¼`
2. **ç¯å¢ƒ**: é€‰æ‹© `å¼€å‘ç¯å¢ƒ`
3. **ç‚¹å‡»**: `ğŸš€ ç”Ÿæˆé…ç½®`

**ç»“æœ**:

- é…ç½®æ–‡ä»¶ä¼šæ˜¾ç¤ºåœ¨å³ä¾§
- åŒ…å«è¯¦ç»†æ—¥å¿—è¾“å‡º (debugging exporter)
- å¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨

**ä¼°è®¡æ—¶é—´**: 30ç§’

---

### åœºæ™¯2: Kubernetesç”Ÿäº§éƒ¨ç½²

**ç›®æ ‡**: ä¸ºK8sé›†ç¾¤ç”Ÿæˆç”Ÿäº§çº§é…ç½®

**æ­¥éª¤** (å…±6æ­¥):

1. **éƒ¨ç½²æ¨¡å¼**: `Gatewayæ¨¡å¼`
2. **ç¯å¢ƒ**: `ç”Ÿäº§ç¯å¢ƒ`
3. **ä¿¡å·**: å‹¾é€‰ `Traces`, `Metrics`, `Logs`
4. **å¤„ç†å™¨**: å‹¾é€‰ `Memory Limiter`, `Tail Sampling`, `Filter`
5. **å®‰å…¨**: å‹¾é€‰ `å¯ç”¨TLS`, `å¯ç”¨è®¤è¯`
6. **ç‚¹å‡»**: `ğŸš€ ç”Ÿæˆé…ç½®`

**ç»“æœ**:

- å®Œæ•´çš„ç”Ÿäº§çº§é…ç½®
- åŒ…å«æ™ºèƒ½é‡‡æ · (é™ä½90%æˆæœ¬)
- å¸¦TLSå’Œè®¤è¯ä¿æŠ¤
- åˆ‡æ¢åˆ°"éƒ¨ç½²å‘½ä»¤"æ ‡ç­¾å¯è·å–K8séƒ¨ç½²æ¸…å•

**ä¼°è®¡æ—¶é—´**: 2åˆ†é’Ÿ

---

### åœºæ™¯3: é˜¿é‡Œäº‘é›†æˆ

**ç›®æ ‡**: å°†æ•°æ®å‘é€åˆ°é˜¿é‡Œäº‘SLS

**æ­¥éª¤** (å…±5æ­¥):

1. **éƒ¨ç½²æ¨¡å¼**: `Gatewayæ¨¡å¼`
2. **ç¯å¢ƒ**: `ç”Ÿäº§ç¯å¢ƒ`
3. **åç«¯ç±»å‹**: é€‰æ‹© `é˜¿é‡Œäº‘SLS`
4. **åç«¯ç«¯ç‚¹**: å¡«å†™ `cn-hangzhou.log.aliyuncs.com` (æˆ–å…¶ä»–åŒºåŸŸ)
5. **ç‚¹å‡»**: `ğŸš€ ç”Ÿæˆé…ç½®`

**é¢å¤–é…ç½®**:

- éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ (åœ¨éƒ¨ç½²å‘½ä»¤ä¸­æœ‰è¯´æ˜):

  ```bash
  ALIYUN_SLS_PROJECT=your-project
  ALIYUN_SLS_LOGSTORE=your-logstore
  ALIYUN_ACCESS_KEY_ID=your-key-id
  ALIYUN_ACCESS_KEY_SECRET=your-secret
  ```

**ç»“æœ**:

- å®Œæ•´çš„é˜¿é‡Œäº‘SLSé…ç½®
- è‡ªåŠ¨åŒ…å«å°¾éƒ¨é‡‡æ ·ä¼˜åŒ– (æˆæœ¬èŠ‚çº¦98.3%)
- éƒ¨ç½²å‘½ä»¤åŒ…å«ç¯å¢ƒå˜é‡è®¾ç½®

**ä¼°è®¡æ—¶é—´**: 3åˆ†é’Ÿ

---

## ğŸ¯ å¿«é€Ÿå†³ç­–æ ‘

```text
ä½ çš„åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ

â”œâ”€ åˆšå¼€å§‹å­¦ä¹ OpenTelemetry
â”‚  â””â”€> ä½¿ç”¨"åœºæ™¯1: æ–°æ‰‹å…¥é—¨"é…ç½®
â”‚     â””â”€> å¼€å‘ç¯å¢ƒ + Gatewayæ¨¡å¼
â”‚
â”œâ”€ åœ¨Kubernetesç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
â”‚  â”œâ”€ éœ€è¦é‡‡é›†æ¯ä¸ªèŠ‚ç‚¹æ•°æ®
â”‚  â”‚  â””â”€> Agentæ¨¡å¼ (DaemonSet)
â”‚  â”‚
â”‚  â””â”€ éœ€è¦é›†ä¸­å¤„ç†æ•°æ®
â”‚     â””â”€> Gatewayæ¨¡å¼ + å¯ç”¨Tail Sampling
â”‚
â”œâ”€ ä½¿ç”¨é˜¿é‡Œäº‘/è…¾è®¯äº‘/åä¸ºäº‘
â”‚  â””â”€> é€‰æ‹©å¯¹åº”äº‘å¹³å°Exporter
â”‚     â””â”€> å¯ç”¨Tail Samplingé™ä½æˆæœ¬
â”‚
â””â”€ æœ¬åœ°è°ƒè¯•é—®é¢˜
   â””â”€> å¼€å‘ç¯å¢ƒ + Logging Exporter
      â””â”€> æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
```

---

## ğŸ“‹ é…ç½®é¡¹è¯´æ˜ (1åˆ†é’Ÿé€Ÿè§ˆ)

### å¿…å¡«é¡¹

| é¡¹ç›® | è¯´æ˜ | æ¨èå€¼ |
|------|------|--------|
| **éƒ¨ç½²æ¨¡å¼** | Agent/Gateway/æ··åˆ | Gateway (æ–°æ‰‹) |
| **ç¯å¢ƒ** | å¼€å‘/é¢„å‘/ç”Ÿäº§ | æ ¹æ®å®é™…ç¯å¢ƒ |
| **åç«¯ç«¯ç‚¹** | Collectoråœ°å€ | `otel-backend:4317` |

### å¯é€‰é¡¹ (å½±å“æ€§èƒ½å’Œæˆæœ¬)

| é¡¹ç›® | è¯´æ˜ | æ¨èå€¼ |
|------|------|--------|
| **æ‰¹å¤„ç†å¤§å°** | æ‰¹æ¬¡è¶Šå¤§,ååè¶Šé«˜ | 8192 (ç”Ÿäº§) |
| **å†…å­˜é™åˆ¶** | é˜²æ­¢OOM | 2048 MiB (Gateway) |
| **å‹ç¼©ç®—æ³•** | å‡å°‘å¸¦å®½ | gzip (æ¨è) |
| **Tail Sampling** | æ™ºèƒ½é‡‡æ ·,é™ä½æˆæœ¬ | ç”Ÿäº§ç¯å¢ƒå‹¾é€‰ |

---

## ğŸ’¡ å¸¸è§é—®é¢˜ (FAQ)

### Q1: ç”Ÿæˆçš„é…ç½®å¯ä»¥ç›´æ¥ç”¨å—?

**A**: å‡ ä¹å¯ä»¥!åªéœ€è¦:

1. ä¿®æ”¹åç«¯ç«¯ç‚¹åœ°å€ (å¦‚æœä¸æ˜¯é»˜è®¤å€¼)
2. å¦‚æœå¯ç”¨äº†TLS,é…ç½®è¯ä¹¦è·¯å¾„
3. å¦‚æœä½¿ç”¨äº‘å¹³å°,è®¾ç½®è®¿é—®å‡­è¯

### Q2: å¦‚ä½•éªŒè¯é…ç½®æ­£ç¡®æ€§?

**A**: åˆ‡æ¢åˆ°"éªŒè¯è„šæœ¬"æ ‡ç­¾,å¤åˆ¶è„šæœ¬å¹¶è¿è¡Œ:

```bash
# ä¿å­˜è„šæœ¬
cat > validate.sh <<'EOF'
(å¤åˆ¶éªŒè¯è„šæœ¬å†…å®¹)
EOF

# è¿è¡ŒéªŒè¯
chmod +x validate.sh
./validate.sh
```

### Q3: Agentæ¨¡å¼å’ŒGatewayæ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«?

**A**:

- **Agent**: æ¯ä¸ªèŠ‚ç‚¹/Podè¿è¡Œä¸€ä¸ªCollector,è½»é‡çº§ (512MB)
- **Gateway**: é›†ä¸­å¼Collector,å¤„ç†æ‰€æœ‰æ•°æ®,åŠŸèƒ½å¼ºå¤§ (2GB+)
- **æ¨è**: K8sç¯å¢ƒä½¿ç”¨ Agent + Gateway æ··åˆæ¨¡å¼

### Q4: å¦‚ä½•é™ä½äº‘å¹³å°æˆæœ¬?

**A**: å¯ç”¨ **Tail Sampling** å¤„ç†å™¨:

- âœ… ä¿ç•™100%é”™è¯¯å’Œæ…¢è¯·æ±‚
- âœ… é‡‡æ ·10%æ­£å¸¸æµé‡
- âœ… æ€»ä½“æˆæœ¬é™ä½ **~90%**

### Q5: ç”Ÿæˆçš„Kuberneteséƒ¨ç½²æ¸…å•éœ€è¦ä¿®æ”¹å—?

**A**: æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´:

- `namespace`: æ”¹ä¸ºä½ çš„å‘½åç©ºé—´
- `resources`: æ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´CPU/å†…å­˜
- `replicas`: Gatewayå‰¯æœ¬æ•° (æ¨è3ä¸ª)

---

## ğŸ”— ä¸‹ä¸€æ­¥

å®Œæˆé…ç½®ç”Ÿæˆå:

1. **ä¿å­˜é…ç½®**: å¤åˆ¶åˆ° `config.yaml`
2. **éªŒè¯é…ç½®**: è¿è¡ŒéªŒè¯è„šæœ¬
3. **éƒ¨ç½²**: ä½¿ç”¨éƒ¨ç½²å‘½ä»¤
4. **ç›‘æ§**: è®¿é—® `http://localhost:8888/metrics` æŸ¥çœ‹æŒ‡æ ‡

**è¯¦ç»†æ–‡æ¡£**: [README.md](./README.md)

---

## ğŸ‰ å®Œæˆ

ä½ å·²ç»æŒæ¡äº†é…ç½®ç”Ÿæˆå™¨çš„åŸºæœ¬ç”¨æ³•!

**ç”¨æ—¶**: 3åˆ†é’Ÿ  
**ç”Ÿæˆ**: ç”Ÿäº§çº§é…ç½®  
**èŠ‚çº¦**: æ‰‹åŠ¨é…ç½®30åˆ†é’Ÿ â†’ å·¥å…·3åˆ†é’Ÿ = **10å€æå‡**

**å¼€å§‹ä½¿ç”¨**:

```bash
open index.html  # ç«‹å³å¼€å§‹!
```
