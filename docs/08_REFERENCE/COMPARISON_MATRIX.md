# 参考文档对比矩阵

**版本**: 2.0  
**日期**: 2025年10月28日  
**状态**: ✅ 完整

---

## 📋 目录

1. [协议对比](#1-协议对比)
2. [SDK实现对比](#2-sdk实现对比)
3. [导出器对比](#3-导出器对比)
4. [语义约定版本对比](#4-语义约定版本对比)

---

## ⚖️ 协议对比

### 1.1 OTLP协议版本

| 版本 | 发布时间 | gRPC | HTTP/Protobuf | HTTP/JSON | 状态 |
|------|---------|------|---------------|-----------|------|
| **v0.19** | 2023-05 | ✅ | ✅ | ✅ | Stable |
| **v0.20** | 2023-09 | ✅ | ✅ | ✅ | Stable |
| **v1.0** | 2024-02 | ✅ | ✅ | ✅ | **推荐** |
| **v1.1** | 2024-08 | ✅ | ✅ | ✅ | Latest |

### 1.2 传输协议性能对比

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
传输协议基准测试 (10K spans)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
协议             延迟    吞吐量   压缩率  CPU
────────────────────────────────────────
gRPC            45ms    220K/s   75%     15%
HTTP/Protobuf   55ms    180K/s   70%     18%
HTTP/JSON       95ms    105K/s   50%     25%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
推荐: gRPC (服务间) / HTTP/JSON (浏览器)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 1.3 协议特性对比

| 特性 | gRPC | HTTP/Protobuf | HTTP/JSON |
|------|------|---------------|-----------|
| **性能** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| **兼容性** | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **调试** | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **网络效率** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| **流式传输** | ✅ | ❌ | ❌ |
| **浏览器支持** | 部分 | ✅ | ✅ |
| **负载均衡** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 🔗 SDK实现对比

### 2.1 语言SDK对比

| 语言 | SDK状态 | 性能 | 成熟度 | 社区 | 推荐度 |
|------|---------|------|--------|------|--------|
| **Rust** | ✅ Stable | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Go** | ✅ Stable | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Java** | ✅ Stable | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Python** | ✅ Stable | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **JavaScript** | ✅ Stable | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **C++** | ✅ Stable | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| **C#** | ✅ Stable | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

### 2.2 Rust SDK性能基准

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Rust vs 其他语言SDK性能对比 (100K spans)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
语言        延迟    吞吐量   内存    CPU
────────────────────────────────────────
Rust        1.2ms   830K/s   45MB    12%
Go          1.8ms   550K/s   65MB    15%
Java        2.5ms   400K/s   150MB   18%
Python      8.5ms   120K/s   80MB    30%
Node.js     6.2ms   160K/s   95MB    25%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Rust优势: 性能最佳，内存占用最低
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 2.3 SDK特性对比

| 特性 | Rust | Go | Java | Python |
|------|------|-----|------|--------|
| **零拷贝** | ✅ | ⚠️ 部分 | ❌ | ❌ |
| **异步原生** | ✅ Tokio | ✅ Goroutine | ⚠️ Virtual Thread | ⚠️ asyncio |
| **内存安全** | ✅ 编译时 | ⚠️ 运行时 | ⚠️ GC | ⚠️ GC |
| **自动埋点** | ✅ | ✅ | ✅ | ✅ |
| **手动埋点** | ✅ | ✅ | ✅ | ✅ |
| **Metrics** | ✅ | ✅ | ✅ | ✅ |
| **Logs** | ✅ | ✅ | ✅ | ✅ |
| **Profiling** | ✅ | ✅ | ⚠️ | ⚠️ |

---

## ⚡ 导出器对比

### 3.1 Exporter实现对比

| Exporter | 协议 | 性能 | 配置复杂度 | 推荐场景 |
|----------|------|------|-----------|----------|
| **OTLP/gRPC** | gRPC | ⭐⭐⭐⭐⭐ | ⭐⭐ | 服务间通信 |
| **OTLP/HTTP** | HTTP | ⭐⭐⭐⭐ | ⭐ | 通用场景 |
| **Jaeger** | Thrift | ⭐⭐⭐⭐ | ⭐⭐ | Jaeger后端 |
| **Zipkin** | HTTP/JSON | ⭐⭐⭐ | ⭐ | Zipkin后端 |
| **Prometheus** | Pull | ⭐⭐⭐⭐⭐ | ⭐ | 指标采集 |
| **Console** | Stdout | ⭐⭐⭐⭐⭐ | ⭐ | 开发调试 |

### 3.2 导出器性能对比

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Exporter性能测试 (50K spans/s)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Exporter       延迟    成功率   丢失率  CPU
────────────────────────────────────────
OTLP/gRPC      50ms    99.9%    0.1%    10%
OTLP/HTTP      80ms    99.8%    0.2%    12%
Jaeger         70ms    99.7%    0.3%    13%
Zipkin         100ms   99.5%    0.5%    15%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
推荐: OTLP/gRPC (性能和可靠性最佳)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 3.3 批处理配置对比

| 配置 | 低延迟 | 平衡 | 高吞吐 | 说明 |
|------|--------|------|--------|------|
| **batch_size** | 100 | 512 | 2048 | 批次大小 |
| **timeout** | 1s | 5s | 10s | 超时时间 |
| **queue_size** | 1K | 10K | 100K | 队列大小 |
| **workers** | 2 | 4 | 8 | 并发数 |
| **延迟** | <100ms | <1s | <5s | P99延迟 |
| **吞吐** | 10K/s | 50K/s | 200K/s | spans/s |
| **内存** | 50MB | 200MB | 800MB | 峰值内存 |

---

## 🎯 语义约定版本对比

### 4.1 语义约定演进

| 版本 | 发布时间 | HTTP | DB | RPC | Messaging | 兼容性 |
|------|---------|------|-----|-----|-----------|--------|
| **v1.17** | 2023-Q2 | ✅ | ✅ | ✅ | ✅ | Stable |
| **v1.20** | 2023-Q4 | ✅ | ✅ | ✅ | ✅ | Stable |
| **v1.23** | 2024-Q2 | ✅ | ✅ | ✅ | ✅ | **推荐** |
| **v1.25** | 2024-Q4 | ✅ | ✅ | ✅ | ✅ | Latest |

### 4.2 主要变更

```
v1.25 (Latest) 新增:
- GenAI操作语义约定
- 云事件属性
- Browser性能API
- Messaging batch操作

v1.23 (推荐) 稳定:
- HTTP/1.1, HTTP/2, HTTP/3
- PostgreSQL, MySQL, MongoDB, Redis
- gRPC, GraphQL
- Kafka, RabbitMQ, SQS

向后兼容保证:
- 属性名不删除
- 属性含义不改变
- 新属性向后兼容
```

### 4.3 语义约定覆盖对比

| 领域 | v1.17 | v1.20 | v1.23 | v1.25 |
|------|-------|-------|-------|-------|
| **HTTP** | ✅ 基础 | ✅ HTTP/2 | ✅ HTTP/3 | ✅ WebTransport |
| **数据库** | ✅ 5种 | ✅ 8种 | ✅ 12种 | ✅ 15种 |
| **RPC** | ✅ gRPC | ✅ +GraphQL | ✅ +Connect | ✅ +tRPC |
| **消息队列** | ✅ 4种 | ✅ 6种 | ✅ 8种 | ✅ 10种 |
| **云服务** | ❌ | ⚠️ 部分 | ✅ AWS | ✅ +Azure +GCP |
| **FaaS** | ❌ | ✅ Lambda | ✅ +多云 | ✅ 完整 |
| **AI/ML** | ❌ | ❌ | ⚠️ 实验 | ✅ GenAI |

---

## 📚 采样策略对比

### 5.1 采样器类型

| 采样器 | 复杂度 | 精度 | 开销 | 推荐场景 |
|--------|--------|------|------|----------|
| **AlwaysOn** | ⭐ | 100% | 高 | 开发环境 |
| **AlwaysOff** | ⭐ | 0% | 无 | 特殊场景 |
| **TraceIdRatio** | ⭐ | 配置% | 低 | 固定比例 |
| **ParentBased** | ⭐⭐ | 继承 | 低 | 保持一致 |
| **RateLimiting** | ⭐⭐⭐ | 动态 | 中 | 控制流量 |
| **Probability** | ⭐⭐ | 配置% | 低 | 随机采样 |
| **SmartSampler** | ⭐⭐⭐⭐ | 智能 | 中 | 生产推荐 |

### 5.2 采样决策对比

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
采样策略效果对比 (100K req/s, 1%错误)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
策略            采样率  数据量  错误覆盖  成本
────────────────────────────────────────
全量采样        100%    100%    100%      $$$$
固定10%         10%     10%     10%       $
固定1%          1%      1%      1%        $
错误优先        15%     15%     100%      $
智能采样        12%     12%     100%      $
自适应          8-20%   14%     95%       $$
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
推荐: 智能采样 (错误100%覆盖 + 低成本)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 📊 Context传播对比

### 6.1 传播格式

| 格式 | 大小 | 兼容性 | 性能 | 推荐度 |
|------|------|--------|------|--------|
| **W3C TraceContext** | 55B | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **W3C Baggage** | 可变 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **B3 Single** | 64B | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| **B3 Multi** | 128B | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| **Jaeger** | 可变 | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |

### 6.2 传播开销

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Context传播性能影响 (1M req/s)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
格式              Header大小  解析时间  开销
────────────────────────────────────────
无传播            0B          0ns       0%
W3C TraceContext  55B         100ns     0.01%
W3C + Baggage     200B        150ns     0.015%
B3 Single         64B         80ns      0.008%
B3 Multi          128B        120ns     0.012%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
结论: Context传播开销可忽略不计
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 💡 后端存储对比

### 7.1 Trace后端对比

| 后端 | 类型 | 规模 | 查询 | 成本 | 推荐度 |
|------|------|------|------|------|--------|
| **Jaeger** | OSS | 中小 | ⭐⭐⭐⭐ | $ | ⭐⭐⭐⭐⭐ |
| **Tempo** | OSS | 大 | ⭐⭐⭐ | $ | ⭐⭐⭐⭐ |
| **Elastic APM** | OSS | 大 | ⭐⭐⭐⭐⭐ | $$ | ⭐⭐⭐⭐ |
| **Datadog APM** | 商业 | 极大 | ⭐⭐⭐⭐⭐ | $$$$ | ⭐⭐⭐⭐ |
| **New Relic** | 商业 | 极大 | ⭐⭐⭐⭐⭐ | $$$$ | ⭐⭐⭐⭐ |
| **Lightstep** | 商业 | 极大 | ⭐⭐⭐⭐⭐ | $$$$$ | ⭐⭐⭐ |

### 7.2 成本对比

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
存储成本对比 (1TB traces/月)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
方案              部署    存储    查询    总计
────────────────────────────────────────
Jaeger(自托管)    $500    $200    $100    $800
Tempo(自托管)     $500    $150    $50     $700
Datadog           $0      $2000   $500    $2500
New Relic         $0      $1800   $400    $2200
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
自托管: 成本低，需运维
云服务: 成本高，免运维
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## ✅ 决策建议

### 8.1 技术选型决策树

```
开始
 ├─ 性能最优先？
 │   └─ YES → Rust SDK + gRPC + 自托管
 ├─ 快速上手？
 │   └─ YES → Go/Python SDK + HTTP/JSON + 云服务
 ├─ 大规模？
 │   └─ YES → 多语言SDK + gRPC + Tempo/商业
 └─ 成本敏感？
     └─ YES → 语言SDK + 智能采样 + Jaeger
```

### 8.2 推荐组合

| 场景 | SDK | 协议 | 采样 | 后端 |
|------|-----|------|------|------|
| **初创公司** | Go/Python | HTTP/JSON | 10%固定 | Jaeger |
| **高性能** | Rust | gRPC | 智能 | Tempo |
| **企业级** | 多语言 | gRPC | 自适应 | Datadog |
| **开发环境** | 任意 | HTTP/JSON | 100% | Console |

---

## 🔗 相关资源

- [知识图谱](./KNOWLEDGE_GRAPH.md)
- [概念定义](./CONCEPTS.md)
- [参考文档README](./README.md)
- [OpenTelemetry规范](https://opentelemetry.io/docs/specs/)

---

**版本**: 2.0  
**创建日期**: 2025-10-28  
**最后更新**: 2025-10-28  
**维护团队**: OTLP_rust参考团队

---

> **💡 提示**: 技术选型应综合考虑性能、成本、团队能力。对于Rust项目，推荐使用Rust SDK + gRPC + 智能采样，可获得最佳性能。
