# eBPF æž¶æž„è®¾è®¡æ–‡æ¡£ 2025

**åˆ›å»ºæ—¥æœŸ**: 2025å¹´1æœˆ
**çŠ¶æ€**: ðŸ“š æž¶æž„æ–‡æ¡£
**Rust ç‰ˆæœ¬**: 1.92+

---

## ðŸ“‹ ç›®å½•

- [eBPF æž¶æž„è®¾è®¡æ–‡æ¡£ 2025](#ebpf-æž¶æž„è®¾è®¡æ–‡æ¡£-2025)
  - [ðŸ“‹ ç›®å½•](#-ç›®å½•)
  - [æ¦‚è¿°](#æ¦‚è¿°)
  - [æž¶æž„è®¾è®¡](#æž¶æž„è®¾è®¡)
    - [æ•´ä½“æž¶æž„](#æ•´ä½“æž¶æž„)
  - [æ¨¡å—ç»“æž„](#æ¨¡å—ç»“æž„)
    - [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
  - [æ•°æ®æµ](#æ•°æ®æµ)
    - [CPU æ€§èƒ½åˆ†æžæ•°æ®æµ](#cpu-æ€§èƒ½åˆ†æžæ•°æ®æµ)
    - [ç½‘ç»œè¿½è¸ªæ•°æ®æµ](#ç½‘ç»œè¿½è¸ªæ•°æ®æµ)
  - [æŽ¥å£è®¾è®¡](#æŽ¥å£è®¾è®¡)
    - [æ ¸å¿ƒæŽ¥å£](#æ ¸å¿ƒæŽ¥å£)
  - [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
    - [CPU å¼€é”€](#cpu-å¼€é”€)
    - [å†…å­˜å¼€é”€](#å†…å­˜å¼€é”€)
    - [å»¶è¿Ÿ](#å»¶è¿Ÿ)
  - [å®‰å…¨è€ƒè™‘](#å®‰å…¨è€ƒè™‘)
    - [æƒé™ç®¡ç†](#æƒé™ç®¡ç†)
    - [ç¨‹åºéªŒè¯](#ç¨‹åºéªŒè¯)
    - [æ•°æ®å®‰å…¨](#æ•°æ®å®‰å…¨)
  - [å‚è€ƒèµ„æº](#å‚è€ƒèµ„æº)

---

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿° eBPF æ¨¡å—çš„æž¶æž„è®¾è®¡ï¼ŒåŒ…æ‹¬æ¨¡å—ç»“æž„ã€æ•°æ®æµã€æŽ¥å£è®¾è®¡å’Œæ€§èƒ½/å®‰å…¨è€ƒè™‘ã€‚

---

## æž¶æž„è®¾è®¡

### æ•´ä½“æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨ç¨‹åºå±‚                            â”‚
â”‚  (ä½¿ç”¨ eBPF æ¨¡å—çš„åº”ç”¨ç¨‹åº)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   eBPF API å±‚                            â”‚
â”‚  - EbpfLoader (ç¨‹åºåŠ è½½)                                 â”‚
â”‚  - EbpfCpuProfiler (CPUæ€§èƒ½åˆ†æž)                         â”‚
â”‚  - EbpfNetworkTracer (ç½‘ç»œè¿½è¸ª)                          â”‚
â”‚  - EbpfSyscallTracer (ç³»ç»Ÿè°ƒç”¨è¿½è¸ª)                      â”‚
â”‚  - EbpfMemoryTracer (å†…å­˜è¿½è¸ª)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  eBPF æ ¸å¿ƒå±‚                             â”‚
â”‚  - Probes (æŽ¢é’ˆç®¡ç†)                                     â”‚
â”‚  - Events (äº‹ä»¶å¤„ç†)                                     â”‚
â”‚  - Maps (Mapsç®¡ç†)                                       â”‚
â”‚  - Integration (OpenTelemetryé›†æˆ)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 eBPF åŸºç¡€å±‚                              â”‚
â”‚  - Types (æ•°æ®ç±»åž‹)                                      â”‚
â”‚  - Error (é”™è¯¯å¤„ç†)                                      â”‚
â”‚  - Utils (å·¥å…·å‡½æ•°)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  eBPF åº“å±‚                               â”‚
â”‚  - aya (Rust eBPFåº“)                                     â”‚
â”‚  - object (å¯¹è±¡æ–‡ä»¶è§£æž)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Linux å†…æ ¸                            â”‚
â”‚  - eBPF ç¨‹åºæ‰§è¡Œ                                         â”‚
â”‚  - eBPF Maps                                             â”‚
â”‚  - ç³»ç»Ÿè°ƒç”¨æŽ¥å£                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å—ç»“æž„

### æ ¸å¿ƒæ¨¡å—

1. **loader.rs** - eBPF ç¨‹åºåŠ è½½å™¨
   - åŠ è½½ eBPF ç¨‹åºå­—èŠ‚ç 
   - éªŒè¯ç¨‹åºå®‰å…¨æ€§
   - ç®¡ç†ç³»ç»Ÿæ”¯æŒæ£€æŸ¥

2. **probes.rs** - æŽ¢é’ˆç®¡ç†
   - kprobes (å†…æ ¸å‡½æ•°æŽ¢é’ˆ)
   - uprobes (ç”¨æˆ·ç©ºé—´å‡½æ•°æŽ¢é’ˆ)
   - tracepoints (é™æ€è¿½è¸ªç‚¹)

3. **events.rs** - äº‹ä»¶å¤„ç†
   - äº‹ä»¶æ”¶é›†
   - äº‹ä»¶è¿‡æ»¤
   - äº‹ä»¶åˆ†å‘

4. **maps.rs** - eBPF Maps ç®¡ç†
   - Map åˆ›å»ºå’Œè®¿é—®
   - æ•°æ®è¯»å†™
   - Map ç±»åž‹ç®¡ç†

5. **profiling.rs** - CPU æ€§èƒ½åˆ†æž
   - CPU é‡‡æ ·
   - Profile ç”Ÿæˆ
   - å¼€é”€è·Ÿè¸ª

6. **networking.rs** - ç½‘ç»œè¿½è¸ª
   - TCP/UDP è¿½è¸ª
   - è¿žæŽ¥è·Ÿè¸ª
   - æ•°æ®åŒ…ç»Ÿè®¡

7. **syscalls.rs** - ç³»ç»Ÿè°ƒç”¨è¿½è¸ª
   - ç³»ç»Ÿè°ƒç”¨äº‹ä»¶
   - è°ƒç”¨ç»Ÿè®¡
   - æ€§èƒ½åˆ†æž

8. **memory.rs** - å†…å­˜è¿½è¸ª
   - å†…å­˜åˆ†é…è¿½è¸ª
   - å†…å­˜é‡Šæ”¾è¿½è¸ª
   - å†…å­˜ä½¿ç”¨ç»Ÿè®¡

9. **integration.rs** - OpenTelemetry é›†æˆ
   - äº‹ä»¶åˆ° Span è½¬æ¢
   - äº‹ä»¶åˆ° Metric è½¬æ¢
   - Profile åˆ° OTLP è½¬æ¢

10. **types.rs** - æ•°æ®ç±»åž‹å®šä¹‰
    - é…ç½®ç±»åž‹
    - äº‹ä»¶ç±»åž‹
    - æŒ‡æ ‡ç±»åž‹

11. **error.rs** - é”™è¯¯å¤„ç†
    - é”™è¯¯ç±»åž‹å®šä¹‰
    - é”™è¯¯è½¬æ¢
    - é”™è¯¯ä¸Šä¸‹æ–‡

12. **utils.rs** - å·¥å…·å‡½æ•°
    - é…ç½®éªŒè¯
    - æŽ¨èé…ç½®
    - è¾…åŠ©å‡½æ•°

---

## æ•°æ®æµ

### CPU æ€§èƒ½åˆ†æžæ•°æ®æµ

```
1. ç”¨æˆ·è°ƒç”¨ EbpfCpuProfiler::start()
   â”‚
   â–¼
2. åŠ è½½ eBPF ç¨‹åº (loader.rs)
   â”‚
   â–¼
3. é™„åŠ åˆ° perf events (probes.rs)
   â”‚
   â–¼
4. å†…æ ¸é‡‡æ · CPU (Linux å†…æ ¸)
   â”‚
   â–¼
5. äº‹ä»¶å†™å…¥ eBPF Map (å†…æ ¸)
   â”‚
   â–¼
6. ç”¨æˆ·ç©ºé—´è¯»å–äº‹ä»¶ (events.rs)
   â”‚
   â–¼
7. è½¬æ¢ä¸º Profile æ ¼å¼ (profiling.rs)
   â”‚
   â–¼
8. è¿”å›žç»™ç”¨æˆ· (EbpfCpuProfiler::stop())
```

### ç½‘ç»œè¿½è¸ªæ•°æ®æµ

```
1. ç”¨æˆ·è°ƒç”¨ EbpfNetworkTracer::start()
   â”‚
   â–¼
2. åŠ è½½ç½‘ç»œè¿½è¸ª eBPF ç¨‹åº
   â”‚
   â–¼
3. é™„åŠ åˆ°ç½‘ç»œäº‹ä»¶ (tracepoints/kprobes)
   â”‚
   â–¼
4. å†…æ ¸æ•èŽ·ç½‘ç»œäº‹ä»¶
   â”‚
   â–¼
5. äº‹ä»¶å†™å…¥ eBPF Map
   â”‚
   â–¼
6. ç”¨æˆ·ç©ºé—´è¯»å–äº‹ä»¶
   â”‚
   â–¼
7. è½¬æ¢ä¸º OpenTelemetry æ ¼å¼ (integration.rs)
   â”‚
   â–¼
8. å¯¼å‡ºåˆ° OTLP Collector
```

---

## æŽ¥å£è®¾è®¡

### æ ¸å¿ƒæŽ¥å£

```rust
// åŠ è½½å™¨æŽ¥å£
pub struct EbpfLoader {
    // ...
}

impl EbpfLoader {
    pub fn new(config: EbpfConfig) -> Self;
    pub fn load(&mut self, program_bytes: &[u8]) -> Result<()>;
    pub fn check_system_support() -> Result<()>;
}

// CPU æ€§èƒ½åˆ†æžå™¨æŽ¥å£
pub struct EbpfCpuProfiler {
    // ...
}

impl EbpfCpuProfiler {
    pub fn new(config: EbpfConfig) -> Self;
    pub fn start(&mut self) -> Result<()>;
    pub fn stop(&mut self) -> Result<PprofProfile>;
}

// ç½‘ç»œè¿½è¸ªå™¨æŽ¥å£
pub struct EbpfNetworkTracer {
    // ...
}

impl EbpfNetworkTracer {
    pub fn new(config: EbpfConfig) -> Self;
    pub fn start(&mut self) -> Result<()>;
    pub fn stop(&mut self) -> Result<Vec<EbpfEvent>>;
}
```

---

## æ€§èƒ½è€ƒè™‘

### CPU å¼€é”€

- **ç›®æ ‡**: <1% CPU å¼€é”€
- **ç­–ç•¥**:
  - å¯é…ç½®é‡‡æ ·é¢‘çŽ‡
  - äº‹ä»¶è¿‡æ»¤å’Œèšåˆ
  - æ‰¹é‡å¤„ç†

### å†…å­˜å¼€é”€

- **ç›®æ ‡**: <50MB å†…å­˜
- **ç­–ç•¥**:
  - é™åˆ¶ç¼“å†²åŒºå¤§å°
  - åŠæ—¶æ¸…ç†æ•°æ®
  - æµå¼å¤„ç†

### å»¶è¿Ÿ

- **ç›®æ ‡**: æœ€å°åŒ–å¯¹åº”ç”¨ç¨‹åºçš„å½±å“
- **ç­–ç•¥**:
  - å¼‚æ­¥äº‹ä»¶å¤„ç†
  - éžé˜»å¡ž API
  - åŽå°å¤„ç†

---

## å®‰å…¨è€ƒè™‘

### æƒé™ç®¡ç†

- éœ€è¦ CAP_BPF æƒé™
- é¿å…ä½¿ç”¨ root
- æœ€å°æƒé™åŽŸåˆ™

### ç¨‹åºéªŒè¯

- å†…æ ¸éªŒè¯ eBPF ç¨‹åº
- é™æ€åˆ†æžï¼ˆå¯é€‰ï¼‰
- è¿è¡Œæ—¶æ£€æŸ¥

### æ•°æ®å®‰å…¨

- æ•°æ®åŠ å¯†ä¼ è¾“
- è®¿é—®æŽ§åˆ¶
- å®¡è®¡æ—¥å¿—

---

## å‚è€ƒèµ„æº

- [ä½¿ç”¨æŒ‡å—](./EBPF_USAGE_GUIDE_2025.md)
- [é›†æˆæŒ‡å—](./EBPF_INTEGRATION_GUIDE_2025.md)
- [æœ€ä½³å®žè·µ](./EBPF_BEST_PRACTICES_2025.md)
- [å®žæ–½è®¡åˆ’](../EBPF_IMPLEMENTATION_PLAN_2025.md)

---

**çŠ¶æ€**: ðŸ“š æž¶æž„æ–‡æ¡£
**æœ€åŽæ›´æ–°**: 2025å¹´1æœˆ
